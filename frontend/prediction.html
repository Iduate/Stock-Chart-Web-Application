<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏòàÏ∏°ÌïòÍ∏∞ - StockChart</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìà</text></svg>">

    <!-- Tailwind CSS with TradingView Color Scheme -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tv': {
                            'darker': '#0d1421',
                            'dark': '#131722',
                            'card': '#1e222d',
                            'light': '#2a2e39',
                            'border': '#363a45',
                            'blue': '#2962ff',
                            'green': '#26a69a',
                            'red': '#ef5350',
                            'text': '#d1d4dc',
                            'text-secondary': '#868993'
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'Noto Sans KR', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Chart.js for interactive charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>

<body class="bg-tv-darker text-tv-text min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-tv-dark border-b border-tv-border sticky top-0 z-40 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <a href="home.html"
                        class="flex items-center space-x-2 text-tv-text hover:text-tv-blue transition-colors">
                        <div class="w-8 h-8 bg-tv-blue rounded-lg flex items-center justify-center">
                            <i class="fas fa-chart-line text-white text-sm"></i>
                        </div>
                        <span class="text-xl font-bold">StockChart</span>
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-1">
                    <a href="home.html"
                        class="px-4 py-2 rounded-lg text-tv-text-secondary hover:text-tv-text hover:bg-tv-light transition-all duration-200">Ìôà</a>
                    <a href="charts.html"
                        class="px-4 py-2 rounded-lg text-tv-text-secondary hover:text-tv-text hover:bg-tv-light transition-all duration-200">Ï∞®Ìä∏
                        Î≥¥Îìú</a>
                    <a href="prediction.html"
                        class="px-4 py-2 rounded-lg text-tv-text bg-tv-blue bg-opacity-20 border border-tv-blue">ÏòàÏ∏°ÌïòÍ∏∞</a>
                    <a href="my-predictions.html"
                        class="px-4 py-2 rounded-lg text-tv-text-secondary hover:text-tv-text hover:bg-tv-light transition-all duration-200">ÎÇ¥
                        ÏòàÏ∏°</a>
                    <a href="ranking.html"
                        class="px-4 py-2 rounded-lg text-tv-text-secondary hover:text-tv-text hover:bg-tv-light transition-all duration-200">Îû≠ÌÇπ</a>
                    <a href="events.html"
                        class="px-4 py-2 rounded-lg text-tv-text-secondary hover:text-tv-text hover:bg-tv-light transition-all duration-200">Ïù¥Î≤§Ìä∏</a>
                    <a href="subscription.html"
                        class="px-4 py-2 rounded-lg text-tv-text-secondary hover:text-tv-text hover:bg-tv-light transition-all duration-200">Íµ¨ÎèÖ</a>
                    <button onclick="showLoginModal()"
                        class="ml-4 bg-tv-blue hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors">Î°úÍ∑∏Ïù∏</button>
                </div>

                <!-- Mobile menu button -->
                <div class="lg:hidden">
                    <button onclick="toggleMobileMenu()"
                        class="relative z-[99999] text-tv-text-secondary hover:text-white p-2 rounded-lg transition-all duration-300 hover:bg-tv-light"
                        id="mobileMenuButton" aria-label="Î©îÎâ¥ Ïó¥Í∏∞">
                        <div class="w-6 h-6 flex flex-col justify-center items-center">
                            <span
                                class="hamburger-line w-6 h-0.5 bg-current transition-all duration-300 transform origin-center"></span>
                            <span
                                class="hamburger-line w-6 h-0.5 bg-current transition-all duration-300 transform origin-center mt-1.5"></span>
                            <span
                                class="hamburger-line w-6 h-0.5 bg-current transition-all duration-300 transform origin-center mt-1.5"></span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobileMenu"
        class="lg:hidden fixed inset-0 z-[9999] transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="absolute inset-0 bg-black bg-opacity-50" onclick="toggleMobileMenu()"></div>
        <div class="absolute right-0 top-0 h-full w-80 bg-tv-dark border-l border-tv-border shadow-2xl">
            <div class="p-6 space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-tv-text">Î©îÎâ¥</h3>
                    <button onclick="toggleMobileMenu()" class="text-tv-text-secondary hover:text-white p-2">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="space-y-3">
                    <a href="home.html"
                        class="flex items-center space-x-3 text-tv-text-secondary hover:text-tv-text p-3 rounded-lg hover:bg-tv-light transition-all duration-200">
                        <i class="fas fa-home w-5"></i>
                        <span>Ìôà</span>
                    </a>
                    <a href="charts.html"
                        class="flex items-center space-x-3 text-tv-text-secondary hover:text-tv-text p-3 rounded-lg hover:bg-tv-light transition-all duration-200">
                        <i class="fas fa-chart-line w-5"></i>
                        <span>Ï∞®Ìä∏ Î≥¥Îìú</span>
                    </a>
                    <a href="prediction.html"
                        class="flex items-center space-x-3 text-tv-text bg-tv-blue bg-opacity-20 border border-tv-blue p-3 rounded-lg">
                        <i class="fas fa-lightbulb w-5"></i>
                        <span>ÏòàÏ∏°ÌïòÍ∏∞</span>
                    </a>
                    <a href="my-predictions.html"
                        class="flex items-center space-x-3 text-tv-text-secondary hover:text-tv-text p-3 rounded-lg hover:bg-tv-light transition-all duration-200">
                        <i class="fas fa-user-chart w-5"></i>
                        <span>ÎÇ¥ ÏòàÏ∏°</span>
                    </a>
                    <a href="ranking.html"
                        class="flex items-center space-x-3 text-tv-text-secondary hover:text-tv-text p-3 rounded-lg hover:bg-tv-light transition-all duration-200">
                        <i class="fas fa-trophy w-5"></i>
                        <span>Îû≠ÌÇπ</span>
                    </a>
                    <a href="events.html"
                        class="flex items-center space-x-3 text-tv-text-secondary hover:text-tv-text p-3 rounded-lg hover:bg-tv-light transition-all duration-200">
                        <i class="fas fa-calendar w-5"></i>
                        <span>Ïù¥Î≤§Ìä∏</span>
                    </a>
                    <a href="subscription.html"
                        class="flex items-center space-x-3 text-tv-text-secondary hover:text-tv-text p-3 rounded-lg hover:bg-tv-light transition-all duration-200">
                        <i class="fas fa-crown w-5"></i>
                        <span>Íµ¨ÎèÖ</span>
                    </a>
                </div>
                <div class="pt-6 border-t border-tv-border">
                    <button onclick="showLoginModal()"
                        class="w-full bg-tv-blue hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Î°úÍ∑∏Ïù∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="py-8 bg-tv-darker min-h-screen">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Page Header -->
            <div class="mb-8 text-center">
                <h1 class="text-4xl font-bold text-tv-text mb-4">Ï£ºÏãù ÏòàÏ∏°ÌïòÍ∏∞</h1>
                <p class="text-lg text-tv-text-secondary">Ï¢ÖÎ™©ÏùÑ ÏÑ†ÌÉùÌïòÍ≥† ÏòàÏ∏° Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏó¨ ÏòàÏ∏°ÏùÑ Î∞úÌñâÌïòÏÑ∏Ïöî</p>
            </div>

            <!-- Main Form -->
            <div class="bg-tv-card border border-tv-border rounded-2xl p-8 shadow-xl">
                <form id="predictionForm" class="space-y-8">

                    <!-- Step 1: Stock Selection -->
                    <div class="space-y-4">
                        <label class="block text-lg font-semibold text-tv-text">
                            <i class="fas fa-chart-line text-tv-blue mr-2"></i>Ï¢ÖÎ™© ÏÑ†ÌÉù
                        </label>

                        <!-- Stock Search -->
                        <input type="text" id="stockSearch"
                            class="w-full px-4 py-3 bg-tv-light border border-tv-border rounded-lg text-tv-text focus:ring-2 focus:ring-tv-blue focus:border-tv-blue transition-all"
                            placeholder="Ï¢ÖÎ™©Î™Ö ÎòêÎäî Ïã¨Î≥º Í≤ÄÏÉâ (Ïòà: AAPL, TSLA, BTC)">

                        <!-- Stock Selection Dropdown -->
                        <select id="stockSelect" name="stock_symbol" required
                            class="w-full px-4 py-3 bg-tv-light border border-tv-border rounded-lg text-tv-text focus:ring-2 focus:ring-tv-blue focus:border-tv-blue transition-all">
                            <option value="">Ï¢ÖÎ™©ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>

                            <!-- US Stocks -->
                            <optgroup label="üá∫üá∏ ÎØ∏Íµ≠ Ï£ºÏãù">
                                <option value="AAPL">AAPL - Ïï†Ìîå</option>
                                <option value="MSFT">MSFT - ÎßàÏù¥ÌÅ¨Î°úÏÜåÌîÑÌä∏</option>
                                <option value="GOOGL">GOOGL - Íµ¨Í∏Ä (ÏïåÌååÎ≤≥)</option>
                                <option value="AMZN">AMZN - ÏïÑÎßàÏ°¥</option>
                                <option value="TSLA">TSLA - ÌÖåÏä¨Îùº</option>
                                <option value="NVDA">NVDA - ÏóîÎπÑÎîîÏïÑ</option>
                                <option value="META">META - Î©îÌÉÄ (ÌéòÏù¥Ïä§Î∂Å)</option>
                                <option value="NFLX">NFLX - ÎÑ∑ÌîåÎ¶≠Ïä§</option>
                                <option value="CRM">CRM - ÏÑ∏ÏùºÏ¶àÌè¨Ïä§</option>
                                <option value="PYPL">PYPL - ÌéòÏù¥Ìåî</option>
                                <option value="ADBE">ADBE - Ïñ¥ÎèÑÎπÑ</option>
                                <option value="INTC">INTC - Ïù∏ÌÖî</option>
                                <option value="AMD">AMD - AMD</option>
                                <option value="CSCO">CSCO - ÏãúÏä§ÏΩî</option>
                                <option value="ORCL">ORCL - Ïò§ÎùºÌÅ¥</option>
                                <option value="IBM">IBM - IBM</option>
                                <option value="UBER">UBER - Ïö∞Î≤Ñ</option>
                                <option value="SPOT">SPOT - Ïä§Ìè¨Ìã∞ÌååÏù¥</option>
                                <option value="ZM">ZM - Ï§å</option>
                                <option value="SQ">SQ - Î∏îÎ°ù (Ïä§ÌÄòÏñ¥)</option>
                                <option value="V">V - ÎπÑÏûê</option>
                                <option value="MA">MA - ÎßàÏä§ÌÑ∞Ïπ¥Îìú</option>
                                <option value="JPM">JPM - JPÎ™®Í±¥</option>
                                <option value="JNJ">JNJ - Ï°¥Ïä®Ïï§Ï°¥Ïä®</option>
                                <option value="WMT">WMT - ÏõîÎßàÌä∏</option>
                                <option value="PG">PG - ÌîÑÎ°ùÌÑ∞Ïï§Í∞¨Î∏î</option>
                                <option value="UNH">UNH - Ïú†ÎÇòÏù¥Ìã∞ÎìúÌó¨Ïä§</option>
                                <option value="HD">HD - ÌôàÎîîÌè¨</option>
                                <option value="BAC">BAC - Î±ÖÌÅ¨Ïò§Î∏åÏïÑÎ©îÎ¶¨Ïπ¥</option>
                                <option value="DIS">DIS - ÎîîÏ¶àÎãà</option>
                                <option value="ADBE">ADBE - Ïñ¥ÎèÑÎπÑ</option>
                                <option value="CRM">CRM - ÏÑ∏ÏùºÏ¶àÌè¨Ïä§</option>
                                <option value="NOW">NOW - ÏÑúÎπÑÏä§ÎÇòÏö∞</option>
                                <option value="BABA">BABA - ÏïåÎ¶¨Î∞îÎ∞î</option>
                                <option value="PFE">PFE - ÌôîÏù¥Ïûê</option>
                                <option value="KO">KO - ÏΩîÏπ¥ÏΩúÎùº</option>
                                <option value="PEP">PEP - Ìé©ÏãúÏΩî</option>
                                <option value="TMO">TMO - Ïç®Î™®ÌîºÏÖî</option>
                                <option value="ABT">ABT - Ïï†Î≤ó</option>
                                <option value="COST">COST - ÏΩîÏä§Ìä∏ÏΩî</option>
                                <option value="AVGO">AVGO - Î∏åÎ°úÎìúÏª¥</option>
                                <option value="TXN">TXN - ÌÖçÏÇ¨Ïä§Ïù∏Ïä§Ìä∏Î£®Î®ºÌä∏</option>
                                <option value="QCOM">QCOM - ÌÄÑÏª¥</option>
                                <option value="LLY">LLY - ÏùºÎùºÏù¥Î¶¥Î¶¨</option>
                                <option value="XOM">XOM - ÏóëÏÜêÎ™®Îπå</option>
                                <option value="CVX">CVX - ÏÖ∞Î∏åÎ°†</option>
                                <option value="ABBV">ABBV - Ïï†ÎπÑ</option>
                                <option value="MRK">MRK - Î®∏ÌÅ¨</option>
                                <option value="ACN">ACN - Ïï°ÏÑºÏ∏ÑÏñ¥</option>
                                <option value="ORCL">ORCL - Ïò§ÎùºÌÅ¥</option>
                                <option value="VZ">VZ - Î≤ÑÎùºÏù¥Ï¶å</option>
                                <option value="T">T - AT&T</option>
                                <option value="CMCSA">CMCSA - Ïª¥Ï∫êÏä§Ìä∏</option>
                                <option value="MDT">MDT - Î©îÎìúÌä∏Î°úÎãâ</option>
                                <option value="NEE">NEE - ÎÑ•Ïä§Ìä∏ÏóêÎùºÏóêÎÑàÏßÄ</option>
                            </optgroup>

                            <!-- Korean Stocks -->
                            <optgroup label="üá∞üá∑ ÌïúÍµ≠ Ï£ºÏãù">
                                <option value="005930.KS">005930.KS - ÏÇºÏÑ±Ï†ÑÏûê</option>
                                <option value="000660.KS">000660.KS - SKÌïòÏù¥ÎãâÏä§</option>
                                <option value="035420.KS">035420.KS - ÎÑ§Ïù¥Î≤Ñ</option>
                                <option value="207940.KS">207940.KS - ÏÇºÏÑ±Î∞îÏù¥Ïò§Î°úÏßÅÏä§</option>
                                <option value="006400.KS">006400.KS - ÏÇºÏÑ±SDI</option>
                                <option value="051910.KS">051910.KS - LGÌôîÌïô</option>
                                <option value="096770.KS">096770.KS - SKÏù¥ÎÖ∏Î≤†Ïù¥ÏÖò</option>
                                <option value="028260.KS">028260.KS - ÏÇºÏÑ±Î¨ºÏÇ∞</option>
                                <option value="034730.KS">034730.KS - SK</option>
                                <option value="068270.KS">068270.KS - ÏÖÄÌä∏Î¶¨Ïò®</option>
                                <option value="323410.KS">323410.KS - Ïπ¥Ïπ¥Ïò§Î±ÖÌÅ¨</option>
                                <option value="035720.KS">035720.KS - Ïπ¥Ïπ¥Ïò§</option>
                                <option value="352820.KS">352820.KS - ÌïòÏù¥Î∏å</option>
                                <option value="003670.KS">003670.KS - Ìè¨Ïä§ÏΩîÌôÄÎî©Ïä§</option>
                                <option value="105560.KS">105560.KS - KBÍ∏àÏúµ</option>
                                <option value="055550.KS">055550.KS - Ïã†ÌïúÏßÄÏ£º</option>
                                <option value="086790.KS">086790.KS - ÌïòÎÇòÍ∏àÏúµÏßÄÏ£º</option>
                                <option value="017670.KS">017670.KS - SKÌÖîÎ†àÏΩ§</option>
                                <option value="030200.KS">030200.KS - KT</option>
                                <option value="032830.KS">032830.KS - ÏÇºÏÑ±ÏÉùÎ™Ö</option>
                                <option value="009150.KS">009150.KS - ÏÇºÏÑ±Ï†ÑÍ∏∞</option>
                                <option value="000270.KS">000270.KS - Í∏∞ÏïÑ</option>
                                <option value="005380.KS">005380.KS - ÌòÑÎåÄÏ∞®</option>
                                <option value="012330.KS">012330.KS - ÌòÑÎåÄÎ™®ÎπÑÏä§</option>
                                <option value="066570.KS">066570.KS - LGÏ†ÑÏûê</option>
                                <option value="003550.KS">003550.KS - LG</option>
                                <option value="018260.KS">018260.KS - ÏÇºÏÑ±ÏóêÏä§ÎîîÏóêÏä§</option>
                                <option value="361610.KS">361610.KS - SKÏïÑÏù¥Ïù¥ÌÖåÌÅ¨ÎÜÄÎ°úÏßÄ</option>
                                <option value="247540.KS">247540.KS - ÏóêÏΩîÌîÑÎ°úÎπÑÏó†</option>
                                <option value="373220.KS">373220.KS - LGÏóêÎÑàÏßÄÏÜîÎ£®ÏÖò</option>
                                <option value="036570.KS">036570.KS - ÏóîÏî®ÏÜåÌîÑÌä∏</option>
                                <option value="251270.KS">251270.KS - ÎÑ∑ÎßàÎ∏î</option>
                                <option value="112040.KS">112040.KS - ÏúÑÎ©îÏù¥Îìú</option>
                                <option value="259960.KS">259960.KS - ÌÅ¨ÎûòÌîÑÌÜ§</option>
                                <option value="035900.KS">035900.KS - JYP Ent.</option>
                                <option value="122870.KS">122870.KS - ÏôÄÏù¥ÏßÄÏóîÌÑ∞ÌÖåÏù∏Î®ºÌä∏</option>
                                <option value="041510.KS">041510.KS - ÏóêÏä§Ïó†</option>
                                <option value="000810.KS">000810.KS - ÏÇºÏÑ±ÌôîÏû¨</option>
                                <option value="024110.KS">024110.KS - Í∏∞ÏóÖÏùÄÌñâ</option>
                                <option value="316140.KS">316140.KS - Ïö∞Î¶¨Í∏àÏúµÏßÄÏ£º</option>
                                <option value="128940.KS">128940.KS - ÌïúÎØ∏ÏïΩÌíà</option>
                                <option value="196170.KS">196170.KS - ÏïåÌÖåÏò§Ï††</option>
                                <option value="068760.KS">068760.KS - ÏÖÄÌä∏Î¶¨Ïò®Ï†úÏïΩ</option>
                                <option value="091990.KS">091990.KS - ÏÖÄÌä∏Î¶¨Ïò®Ìó¨Ïä§ÏºÄÏñ¥</option>
                                <option value="207940.KS">207940.KS - ÏÇºÏÑ±Î∞îÏù¥Ïò§Î°úÏßÅÏä§</option>
                                <option value="302440.KS">302440.KS - SKÎ∞îÏù¥Ïò§ÏÇ¨Ïù¥Ïñ∏Ïä§</option>
                            </optgroup>

                            <!-- Japanese Stocks -->
                            <optgroup label="üáØüáµ ÏùºÎ≥∏ Ï£ºÏãù">
                                <option value="7203.T">7203.T - ÎèÑÏöîÌÉÄÏûêÎèôÏ∞®</option>
                                <option value="6758.T">6758.T - ÏÜåÎãàÍ∑∏Î£π</option>
                                <option value="9984.T">9984.T - ÏÜåÌîÑÌä∏Î±ÖÌÅ¨Í∑∏Î£π</option>
                                <option value="6501.T">6501.T - ÌûàÌÉÄÏπò</option>
                                <option value="8306.T">8306.T - ÎØ∏Ïì∞ÎπÑÏãúUFJÏùÄÌñâ</option>
                                <option value="4502.T">4502.T - Îã§ÏºÄÎã§Ï†úÏïΩ</option>
                                <option value="7974.T">7974.T - ÎãåÌÖêÎèÑ</option>
                                <option value="6861.T">6861.T - ÌÇ§ÏóîÏä§</option>
                                <option value="4519.T">4519.T - Ï∂îÍ∞ÄÏù¥Ï†úÏïΩ</option>
                                <option value="8035.T">8035.T - ÎèÑÏøÑÏùºÎ†âÌä∏Î°†</option>
                                <option value="9432.T">9432.T - NTT</option>
                                <option value="4661.T">4661.T - Ïò§Î¶¨ÏóîÌÉàÎûúÎìú</option>
                                <option value="6954.T">6954.T - ÌååÎÇô</option>
                                <option value="7751.T">7751.T - Ï∫êÎÖº</option>
                                <option value="8031.T">8031.T - ÎØ∏Ïì∞Ïù¥Î¨ºÏÇ∞</option>
                                <option value="9434.T">9434.T - ÏÜåÌîÑÌä∏Î±ÖÌÅ¨</option>
                                <option value="4568.T">4568.T - Îã§Ïù¥Ïù¥ÏπòÏÇ∞ÏøÑ</option>
                                <option value="8058.T">8058.T - ÎØ∏Ïì∞ÎπÑÏãúÏÉÅÏÇ¨</option>
                                <option value="9433.T">9433.T - KDDI</option>
                                <option value="4063.T">4063.T - Ïã†ÏóêÏì∞ÌôîÌïô</option>
                                <option value="6098.T">6098.T - Î¶¨Ïø†Î£®Ìä∏ÌôÄÎî©Ïä§</option>
                                <option value="7267.T">7267.T - ÌòºÎã§Í∏∞Ïó∞</option>
                                <option value="8766.T">8766.T - ÎèÑÏøÑÌï¥ÏÉÅ</option>
                                <option value="4911.T">4911.T - ÏãúÏÑ∏Ïù¥ÎèÑ</option>
                                <option value="2914.T">2914.T - JT</option>
                            </optgroup>

                            <!-- Indian Stocks -->
                            <optgroup label="üáÆüá≥ Ïù∏ÎèÑ Ï£ºÏãù">
                                <option value="RELIANCE.NS">RELIANCE.NS - Î¶¥ÎùºÏù¥Ïñ∏Ïä§Ïù∏ÎçîÏä§Ìä∏Î¶¨</option>
                                <option value="TCS.NS">TCS.NS - ÌÉÄÌÉÄÏª®ÏÑ§ÌÑ¥ÏãúÏÑúÎπÑÏä§</option>
                                <option value="HDFCBANK.NS">HDFCBANK.NS - HDFCÏùÄÌñâ</option>
                                <option value="INFY.NS">INFY.NS - Ïù∏Ìè¨ÏãúÏä§</option>
                                <option value="HINDUNILVR.NS">HINDUNILVR.NS - ÌûåÎëêÏä§ÌÉÑÏú†ÎãàÎ†àÎ≤Ñ</option>
                                <option value="ICICIBANK.NS">ICICIBANK.NS - ICICIÏùÄÌñâ</option>
                                <option value="SBIN.NS">SBIN.NS - Ïù∏ÎèÑÍµ≠Î¶ΩÏùÄÌñâ</option>
                                <option value="BHARTIARTL.NS">BHARTIARTL.NS - Î∞îÎ•¥Ìã∞ÏóêÏñ¥ÌÖî</option>
                                <option value="ITC.NS">ITC.NS - ITC</option>
                                <option value="KOTAKBANK.NS">KOTAKBANK.NS - ÏΩîÌÉÅÎßàÌûåÎìúÎùºÏùÄÌñâ</option>
                                <option value="LT.NS">LT.NS - ÎùºÏä®Ïï§Ìà¨Î∏åÎ°ú</option>
                                <option value="ASIANPAINT.NS">ASIANPAINT.NS - ÏïÑÏãúÏïàÌéòÏù∏Ìä∏</option>
                                <option value="MARUTI.NS">MARUTI.NS - ÎßàÎ£®Ìã∞Ïä§Ï¶àÌÇ§</option>
                                <option value="AXISBANK.NS">AXISBANK.NS - Ïï°ÏãúÏä§ÏùÄÌñâ</option>
                                <option value="WIPRO.NS">WIPRO.NS - ÏúÑÌîÑÎ°ú</option>
                                <option value="HCLTECH.NS">HCLTECH.NS - HCLÌÖåÌÅ¨ÎÜÄÎ°úÏßÄ</option>
                                <option value="BAJFINANCE.NS">BAJFINANCE.NS - Î∞îÏ¶àÌååÏù¥ÎÇ∏Ïä§</option>
                                <option value="SUNPHARMA.NS">SUNPHARMA.NS - ÏÑ†ÌååÎßà</option>
                                <option value="TECHM.NS">TECHM.NS - ÌÖåÌÅ¨ÎßàÌûåÎìúÎùº</option>
                                <option value="TITAN.NS">TITAN.NS - ÌÉÄÏù¥ÌÉÑ</option>
                                <option value="ULTRACEMCO.NS">ULTRACEMCO.NS - Ïö∏Ìä∏ÎùºÌÖåÌÅ¨ÏãúÎ©òÌä∏</option>
                                <option value="NESTLEIND.NS">NESTLEIND.NS - ÎÑ§Ïä¨Î†àÏù∏ÎîîÏïÑ</option>
                                <option value="POWERGRID.NS">POWERGRID.NS - ÌååÏõåÍ∑∏Î¶¨Îìú</option>
                                <option value="NTPC.NS">NTPC.NS - NTPC</option>
                                <option value="COALINDIA.NS">COALINDIA.NS - ÏΩúÏù∏ÎîîÏïÑ</option>
                            </optgroup> <!-- UK Stocks -->
                            <optgroup label="üá¨üáß ÏòÅÍµ≠ Ï£ºÏãù">
                                <option value="AZN.L">AZN.L - ÏïÑÏä§Ìä∏ÎùºÏ†úÎÑ§Ïπ¥</option>
                                <option value="SHEL.L">SHEL.L - ÏÖ∏</option>
                                <option value="ULVR.L">ULVR.L - Ïú†ÎãàÎ†àÎ≤Ñ</option>
                                <option value="BP.L">BP.L - BP</option>
                                <option value="HSBA.L">HSBA.L - HSBCÌôÄÎî©Ïä§</option>
                                <option value="GSK.L">GSK.L - GSK</option>
                                <option value="DGE.L">DGE.L - ÎîîÏïÑÏßÄÏò§</option>
                                <option value="RIO.L">RIO.L - Î¶¨Ïò§Ìã¥ÌÜ†</option>
                                <option value="BT-A.L">BT-A.L - BTÍ∑∏Î£π</option>
                                <option value="LLOY.L">LLOY.L - Î°úÏù¥Ï¶àÎ±ÖÌÇπÍ∑∏Î£π</option>
                                <option value="BARC.L">BARC.L - Î∞îÌÅ¥Î†àÏù¥Ïä§</option>
                                <option value="VOD.L">VOD.L - Î≥¥Îã§Ìè∞Í∑∏Î£π</option>
                                <option value="NWG.L">NWG.L - ÎÑ§Ïù¥ÏÖòÏôÄÏù¥ÎìúÍ∑∏Î£π</option>
                                <option value="GLEN.L">GLEN.L - Í∏ÄÎ†åÏΩîÏñ¥</option>
                                <option value="TSCO.L">TSCO.L - ÌÖåÏä§ÏΩî</option>
                            </optgroup>

                            <!-- Canadian Stocks -->
                            <optgroup label="üá®üá¶ Ï∫êÎÇòÎã§ Ï£ºÏãù">
                                <option value="SHOP.TO">SHOP.TO - ÏáºÌîºÌååÏù¥</option>
                                <option value="RY.TO">RY.TO - Î°úÏó¥Î±ÖÌÅ¨Ïò§Î∏åÏ∫êÎÇòÎã§</option>
                                <option value="TD.TO">TD.TO - ÌÜ†Î°†ÌÜ†ÎèÑÎØ∏ÎãàÏñ∏ÏùÄÌñâ</option>
                                <option value="BNS.TO">BNS.TO - Î±ÖÌÅ¨Ïò§Î∏åÎÖ∏Î∞îÏä§ÏΩîÏÉ§</option>
                                <option value="BMO.TO">BMO.TO - Î±ÖÌÅ¨Ïò§Î∏åÎ™¨Ìä∏Î¶¨Ïò¨</option>
                                <option value="CNR.TO">CNR.TO - Ï∫êÎÇòÎîîÏñ∏ÎÇ¥ÏÖîÎÑêÏ≤†ÎèÑ</option>
                                <option value="CP.TO">CP.TO - Ï∫êÎÇòÎîîÏñ∏ÌçºÏãúÌîΩÏ≤†ÎèÑ</option>
                                <option value="CNQ.TO">CNQ.TO - Ï∫êÎÇòÎîîÏñ∏ÎÇ¥Ï∂îÎü¥Î¶¨ÏÜåÏä§</option>
                                <option value="SU.TO">SU.TO - ÏÑ†ÏΩîÏñ¥ÏóêÎÑàÏßÄ</option>
                                <option value="TRI.TO">TRI.TO - ÌÜ∞Ïä®Î°úÏù¥ÌÑ∞</option>
                                <option value="ENB.TO">ENB.TO - ÏóîÎ∏åÎ¶¨ÏßÄ</option>
                                <option value="WN.TO">WN.TO - Ï°∞ÏßÄÏõ®Ïä§ÌÑ¥</option>
                                <option value="CSU.TO">CSU.TO - Ïª®Ïä§ÌÖîÎ†àÏù¥ÏÖòÏÜåÌîÑÌä∏Ïõ®Ïñ¥</option>
                                <option value="ATD.TO">ATD.TO - ÏïåÎ¶¨Î©òÌÖåÏù¥ÏÖòÏø†ÏÖ∞ÌÉÄÎìú</option>
                                <option value="CCL-B.TO">CCL-B.TO - CCLÏù∏ÎçîÏä§Ìä∏Î¶¨</option>
                            </optgroup>

                            <!-- French Stocks -->
                            <optgroup label="üá´üá∑ ÌîÑÎûëÏä§ Ï£ºÏãù">
                                <option value="MC.PA">MC.PA - LVMH</option>
                                <option value="OR.PA">OR.PA - Î°úÎ†àÏïå</option>
                                <option value="SAN.PA">SAN.PA - ÏÇ¨ÎÖ∏Ìîº</option>
                                <option value="ASML.PA">ASML.PA - ASMLÌôÄÎî©</option>
                                <option value="TTE.PA">TTE.PA - ÌÜ†ÌÉàÏóêÎÑàÏßÄ</option>
                                <option value="BNP.PA">BNP.PA - BNPÌååÎ¶¨Î∞î</option>
                                <option value="ACA.PA">ACA.PA - ÌÅ¨Î†àÎîîÌä∏ÏïÑÍ∑∏Î¶¨ÏΩú</option>
                                <option value="AI.PA">AI.PA - ÏóêÏñ¥Î¶¨ÌÄ¥Îìú</option>
                                <option value="DG.PA">DG.PA - ÎπàÏπò</option>
                                <option value="BN.PA">BN.PA - Îã§ÎÖº</option>
                                <option value="CAP.PA">CAP.PA - Ï∫°Ï†úÎØ∏Îãà</option>
                                <option value="KER.PA">KER.PA - ÏºÄÎßÅ</option>
                                <option value="RNO.PA">RNO.PA - Î•¥ÎÖ∏</option>
                                <option value="SU.PA">SU.PA - ÏäàÎÇòÏù¥ÎçîÏùºÎ†âÌä∏Î¶≠</option>
                                <option value="AIR.PA">AIR.PA - ÏóêÏñ¥Î≤ÑÏä§</option>
                            </optgroup>

                            <!-- German Stocks -->
                            <optgroup label="üá©üá™ ÎèÖÏùº Ï£ºÏãù">
                                <option value="SAP.DE">SAP.DE - SAP</option>
                                <option value="ASME.DE">ASME.DE - ASMLÌôÄÎî©</option>
                                <option value="SIE.DE">SIE.DE - ÏßÄÎ©òÏä§</option>
                                <option value="ADS.DE">ADS.DE - ÏïÑÎîîÎã§Ïä§</option>
                                <option value="ALV.DE">ALV.DE - ÏïåÎ¶¨ÏïàÏ∏†</option>
                                <option value="BAS.DE">BAS.DE - BASF</option>
                                <option value="BMW.DE">BMW.DE - BMW</option>
                                <option value="DAI.DE">DAI.DE - Î©îÎ•¥ÏÑ∏Îç∞Ïä§Î≤§Ï∏†Í∑∏Î£π</option>
                                <option value="VOW3.DE">VOW3.DE - Ìè≠Ïä§Î∞îÍ≤ê</option>
                                <option value="DBK.DE">DBK.DE - ÎèÑÏù¥Ï≤¥Î±ÖÌÅ¨</option>
                                <option value="MUV2.DE">MUV2.DE - ÎÆåÌó®Ïû¨Î≥¥Ìóò</option>
                                <option value="DTE.DE">DTE.DE - ÎèÑÏù¥Ï≤¥ÌÖîÎ†àÏΩ§</option>
                                <option value="LIN.DE">LIN.DE - Î¶∞Îç∞</option>
                                <option value="BEI.DE">BEI.DE - Î∞îÏù¥Ïñ¥Ïä§ÎèÑÎ•¥ÌîÑ</option>
                                <option value="HEN3.DE">HEN3.DE - Ìó®Ïºà</option>
                            </optgroup>

                            <!-- Taiwanese Stocks -->
                            <optgroup label="üáπüáº ÎåÄÎßå Ï£ºÏãù">
                                <option value="2330.TW">2330.TW - ÎåÄÎßåÎ∞òÎèÑÏ≤¥(TSMC)</option>
                                <option value="2454.TW">2454.TW - ÎØ∏ÎîîÏñ¥ÌÖç</option>
                                <option value="2317.TW">2317.TW - ÌõôÌïòÏù¥Ï†ïÎ∞Ä</option>
                                <option value="2412.TW">2412.TW - Ï§ëÌôîÌÖîÎ†àÏΩ§</option>
                                <option value="1303.TW">1303.TW - ÎÇúÏïºÌîåÎùºÏä§Ìã±</option>
                                <option value="2882.TW">2882.TW - Ï∫êÏÑ∏Ïù¥Í∏àÏúµ</option>
                                <option value="1326.TW">1326.TW - Ìè¨Î™®ÏÇ¨ÏºÄÎØ∏Ïª¨</option>
                                <option value="2408.TW">2408.TW - ÎÇúÏïºÌÖåÌÅ¨ÎÜÄÎ°úÏßÄ</option>
                                <option value="2881.TW">2881.TW - Ìë∏Î≥∏Í∏àÏúµ</option>
                                <option value="3008.TW">3008.TW - ÎùºÍ∞ÑÏ†ïÎ∞Ä</option>
                                <option value="2303.TW">2303.TW - Ïú†ÎÇòÏù¥Ìã∞ÎìúÎßàÏù¥ÌÅ¨Î°úÏùºÎ†âÌä∏Î°úÎãâÏä§</option>
                                <option value="2891.TW">2891.TW - CTBCÍ∏àÏúµ</option>
                                <option value="6505.TW">6505.TW - Ìè¨Î™®ÏÇ¨ÌéòÌä∏Î°úÏºÄÎØ∏Ïª¨</option>
                                <option value="2207.TW">2207.TW - Ìò∏ÌÉÄÏù¥Î™®ÌÑ∞</option>
                                <option value="2886.TW">2886.TW - Î©îÍ∞ÄÍ∏àÏúµ</option>
                            </optgroup>

                            <!-- Cryptocurrencies -->
                            <optgroup label="‚Çø ÏïîÌò∏ÌôîÌèê">
                                <option value="BTC-USD">BTC-USD - ÎπÑÌä∏ÏΩîÏù∏</option>
                                <option value="ETH-USD">ETH-USD - Ïù¥ÎçîÎ¶¨ÏõÄ</option>
                                <option value="BNB-USD">BNB-USD - Î∞îÏù¥ÎÇ∏Ïä§ÏΩîÏù∏</option>
                                <option value="XRP-USD">XRP-USD - Î¶¨Ìîå</option>
                                <option value="ADA-USD">ADA-USD - Ïπ¥Î•¥Îã§ÎÖ∏</option>
                                <option value="SOL-USD">SOL-USD - ÏÜîÎùºÎÇò</option>
                                <option value="DOT-USD">DOT-USD - Ìè¥Ïπ¥Îã∑</option>
                                <option value="DOGE-USD">DOGE-USD - ÎèÑÏßÄÏΩîÏù∏</option>
                                <option value="AVAX-USD">AVAX-USD - ÏïÑÎ∞úÎûÄÏ≤¥</option>
                                <option value="SHIB-USD">SHIB-USD - ÏãúÎ∞îÏù¥ÎàÑ</option>
                                <option value="MATIC-USD">MATIC-USD - Ìè¥Î¶¨Í≥§</option>
                                <option value="LTC-USD">LTC-USD - ÎùºÏù¥Ìä∏ÏΩîÏù∏</option>
                                <option value="UNI-USD">UNI-USD - Ïú†ÎãàÏä§Ïôë</option>
                                <option value="LINK-USD">LINK-USD - Ï≤¥Ïù∏ÎßÅÌÅ¨</option>
                                <option value="ATOM-USD">ATOM-USD - ÏΩîÏä§Î™®Ïä§</option>
                                <option value="TRX-USD">TRX-USD - Ìä∏Î°†</option>
                                <option value="NEAR-USD">NEAR-USD - ÎãàÏñ¥ÌîÑÎ°úÌÜ†ÏΩú</option>
                                <option value="ALGO-USD">ALGO-USD - ÏïåÍ≥†ÎûúÎìú</option>
                                <option value="VET-USD">VET-USD - ÎπÑÏ≤¥Ïù∏</option>
                                <option value="ICP-USD">ICP-USD - Ïù∏ÌÑ∞ÎÑ∑Ïª¥Ìì®ÌÑ∞</option>
                                <option value="FTM-USD">FTM-USD - Ìå¨ÌÖÄ</option>
                                <option value="HBAR-USD">HBAR-USD - Ìó§Îç∞Îùº</option>
                                <option value="FIL-USD">FIL-USD - ÌååÏùºÏΩîÏù∏</option>
                                <option value="ETC-USD">ETC-USD - Ïù¥ÎçîÎ¶¨ÏõÄÌÅ¥ÎûòÏãù</option>
                                <option value="XMR-USD">XMR-USD - Î™®ÎÑ§Î°ú</option>
                                <option value="XLM-USD">XLM-USD - Ïä§ÌÖîÎùº</option>
                                <option value="BCH-USD">BCH-USD - ÎπÑÌä∏ÏΩîÏù∏Ï∫êÏãú</option>
                                <option value="THETA-USD">THETA-USD - ÌÖåÌÉÄ</option>
                                <option value="SAND-USD">SAND-USD - ÎçîÏÉåÎìúÎ∞ïÏä§</option>
                                <option value="MANA-USD">MANA-USD - ÎîîÏÑºÌä∏Îü¥ÎûúÎìú</option>
                                <option value="AXS-USD">AXS-USD - Ïï°ÏãúÏù∏ÌîºÎãàÌã∞</option>
                                <option value="GRT-USD">GRT-USD - ÎçîÍ∑∏ÎûòÌîÑ</option>
                                <option value="ENJ-USD">ENJ-USD - ÏóîÏßÑÏΩîÏù∏</option>
                                <option value="CRV-USD">CRV-USD - Ïª§Î∏å</option>
                                <option value="SUSHI-USD">SUSHI-USD - Ïä§ÏãúÏä§Ïôë</option>
                            </optgroup>
                        </select>

                        <!-- Current Stock Info Display -->
                        <div id="stockInfo" class="hidden bg-tv-light/50 border border-tv-border rounded-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 id="selectedStockName" class="text-xl font-semibold text-tv-text"></h3>
                                    <p id="selectedStockSymbol" class="text-tv-text-secondary"></p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm text-tv-text-secondary">ÌòÑÏû¨ Í∞ÄÍ≤©</p>
                                    <p id="currentStockPrice" class="text-3xl font-bold text-tv-text">$0.00</p>
                                    <p id="loadingPrice" class="text-sm text-tv-blue">
                                        <i class="fas fa-spinner fa-spin mr-1"></i>Í∞ÄÍ≤© Î°úÎî© Ï§ë...
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Interactive Chart Prediction -->
                    <div class="space-y-4">
                        <label class="block text-lg font-semibold text-tv-text">
                            <i class="fas fa-chart-line text-tv-green mr-2"></i>Ï∞®Ìä∏ÏóêÏÑú ÏòàÏ∏°ÌïòÍ∏∞
                        </label>

                        <!-- Chart Instructions -->
                        <div class="bg-tv-blue/10 border border-tv-blue/30 rounded-lg p-4 mb-4">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-info-circle text-tv-blue mt-1"></i>
                                <div class="text-sm text-tv-text">
                                    <p class="font-semibold mb-2">üìä Ï∞®Ìä∏ ÏòàÏ∏° Î∞©Î≤ï:</p>
                                    <ul class="space-y-1 text-tv-text-secondary">
                                        <li>‚Ä¢ Ï∞®Ìä∏ÏóêÏÑú ÎØ∏Îûò ÎÇ†ÏßúÎ°ú Ïù¥ÎèôÌïòÏÑ∏Ïöî</li>
                                        <li>‚Ä¢ ÏõêÌïòÎäî ÎÇ†ÏßúÏôÄ Í∞ÄÍ≤© ÏúÑÏπòÎ•º ÌÅ¥Î¶≠/ÌÑ∞ÏπòÌïòÏÑ∏Ïöî</li>
                                        <li>‚Ä¢ Ïó¨Îü¨ ÎÇ†ÏßúÏóê ÏòàÏ∏°Ï†êÏùÑ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§</li>
                                        <li>‚Ä¢ Î™®Î∞îÏùºÏóêÏÑúÎèÑ ÌÑ∞ÏπòÎ°ú ÏâΩÍ≤å ÏòàÏ∏° Í∞ÄÎä•Ìï©ÎãàÎã§</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Chart Container -->
                        <div class="bg-tv-card border border-tv-border rounded-lg overflow-hidden">
                            <!-- Enhanced Chart Controls -->
                            <div class="bg-tv-light border-b border-tv-border p-4">
                                <!-- Top Row: Search and Time Period Buttons -->
                                <div class="flex items-center justify-between flex-wrap gap-4 mb-4">
                                    <!-- Enhanced Search -->
                                    <div class="flex items-center space-x-4 flex-1 max-w-md">
                                        <div class="relative flex-1">
                                            <input type="text" id="stockSearchInput" placeholder="Ï¢ÖÎ™© Í≤ÄÏÉâ (Ïòà: AAPL, ÏÇºÏÑ±Ï†ÑÏûê)"
                                                class="w-full px-4 py-2 pl-10 bg-tv-darker border border-tv-border rounded-lg text-tv-text placeholder-tv-text-secondary focus:border-tv-blue focus:outline-none">
                                            <i
                                                class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-tv-text-secondary"></i>
                                        </div>
                                    </div>

                                    <!-- Time Period Selection Buttons -->
                                    <div class="flex items-center space-x-1 bg-tv-darker rounded-lg p-1">
                                        <button type="button" data-interval="1m"
                                            class="time-interval-btn px-3 py-1.5 rounded text-sm font-medium transition-all">1Î∂Ñ</button>
                                        <button type="button" data-interval="5m"
                                            class="time-interval-btn px-3 py-1.5 rounded text-sm font-medium transition-all">5Î∂Ñ</button>
                                        <button type="button" data-interval="1h"
                                            class="time-interval-btn px-3 py-1.5 rounded text-sm font-medium transition-all">1ÏãúÍ∞Ñ</button>
                                        <button type="button" data-interval="1d"
                                            class="time-interval-btn px-3 py-1.5 rounded text-sm font-medium transition-all bg-tv-blue text-white">1Ïùº</button>
                                        <button type="button" data-interval="1wk"
                                            class="time-interval-btn px-3 py-1.5 rounded text-sm font-medium transition-all">1Ï£º</button>
                                        <button type="button" data-interval="1mo"
                                            class="time-interval-btn px-3 py-1.5 rounded text-sm font-medium transition-all">1Ïõî</button>
                                    </div>
                                </div>

                                <!-- Bottom Row: Range and Controls -->
                                <div class="flex items-center justify-between flex-wrap gap-4">
                                    <div class="flex items-center space-x-4">
                                        <span class="text-sm font-medium text-tv-text">Îç∞Ïù¥ÌÑ∞ Î≤îÏúÑ:</span>
                                        <select id="chartTimeRange"
                                            class="px-3 py-1 bg-tv-darker border border-tv-border rounded text-tv-text text-sm">
                                            <option value="30">30Ïùº</option>
                                            <option value="90" selected>90Ïùº</option>
                                            <option value="180">180Ïùº</option>
                                            <option value="365">1ÎÖÑ</option>
                                        </select>

                                        <!-- Volume Toggle -->
                                        <label class="flex items-center space-x-2 text-sm">
                                            <input type="checkbox" id="showVolume" checked
                                                class="rounded border-tv-border bg-tv-darker text-tv-blue focus:ring-tv-blue">
                                            <span class="text-tv-text">Í±∞ÎûòÎüâ ÌëúÏãú</span>
                                        </label>
                                    </div>

                                    <div class="flex items-center space-x-2">
                                        <button type="button" id="clearPredictions"
                                            class="px-3 py-1 bg-tv-red/20 border border-tv-red/30 text-tv-red rounded text-sm hover:bg-tv-red/30 transition-colors">
                                            <i class="fas fa-trash mr-1"></i>ÏòàÏ∏° ÏßÄÏö∞Í∏∞
                                        </button>
                                        <button type="button" id="resetZoom"
                                            class="px-3 py-1 bg-tv-blue/20 border border-tv-blue/30 text-tv-blue rounded text-sm hover:bg-tv-blue/30 transition-colors">
                                            <i class="fas fa-search-minus mr-1"></i>Ï§å Î¶¨ÏÖã
                                        </button>
                                        <button type="button" id="fitChart"
                                            class="px-3 py-1 bg-tv-blue/20 border border-tv-blue/30 text-tv-blue rounded text-sm hover:bg-tv-blue/30 transition-colors">
                                            <i class="fas fa-compress-arrows-alt mr-1"></i>Ï†ÑÏ≤¥ Î≥¥Í∏∞
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Chart Canvas Container -->
                            <div id="chartContainer" class="relative bg-tv-darker">
                                <!-- Main Price Chart -->
                                <div class="relative" style="height: 400px;">
                                    <canvas id="predictionChart" class="w-full h-full cursor-crosshair"></canvas>

                                    <!-- Chart Navigation Scrollbar -->
                                    <div class="absolute bottom-2 left-4 right-4">
                                        <div class="bg-tv-light/80 rounded-lg px-3 py-1">
                                            <input type="range" id="chartScrollbar" min="0" max="100" value="100"
                                                class="w-full h-2 bg-tv-border rounded-lg appearance-none cursor-pointer">
                                        </div>
                                    </div>

                                    <!-- Chart Loading/No Data States -->
                                    <div id="chartLoading"
                                        class="absolute inset-0 flex items-center justify-center bg-tv-darker/90">
                                        <div class="text-center">
                                            <i class="fas fa-spinner fa-spin text-tv-blue text-2xl mb-2"></i>
                                            <p class="text-tv-text-secondary">Ï∞®Ìä∏ Î°úÎî© Ï§ë...</p>
                                        </div>
                                    </div>
                                    <div id="noStockSelected"
                                        class="absolute inset-0 flex items-center justify-center bg-tv-darker/90">
                                        <div class="text-center">
                                            <i class="fas fa-chart-line text-tv-text-secondary text-4xl mb-4"></i>
                                            <p class="text-tv-text-secondary">Ï¢ÖÎ™©ÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ Ï∞®Ìä∏Í∞Ä ÌëúÏãúÎê©ÎãàÎã§</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Volume Chart -->
                                <div id="volumeContainer" class="relative border-t border-tv-border"
                                    style="height: 100px;">
                                    <canvas id="volumeChart" class="w-full h-full"></canvas>
                                    <div class="absolute top-2 left-4 text-xs text-tv-text-secondary">Í±∞ÎûòÎüâ</div>
                                </div>

                                <!-- Prediction Point Tooltip -->
                                <div id="predictionTooltip"
                                    class="absolute hidden bg-tv-dark border border-tv-border rounded-lg p-3 shadow-lg z-10">
                                    <div class="text-sm text-tv-text">
                                        <div class="font-semibold mb-1">ÏòàÏ∏° Ìè¨Ïù∏Ìä∏</div>
                                        <div id="tooltipDate" class="text-tv-text-secondary mb-1"></div>
                                        <div id="tooltipPrice" class="text-tv-green font-mono"></div>
                                        <button id="deletePredictionBtn"
                                            class="mt-2 px-2 py-1 bg-tv-red/20 border border-tv-red/30 text-tv-red rounded text-xs hover:bg-tv-red/30 transition-colors">
                                            <i class="fas fa-trash mr-1"></i>ÏÇ≠Ï†ú
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Chart Legend and Info -->
                            <div class="bg-tv-light border-t border-tv-border p-4">
                                <div class="flex items-center justify-between flex-wrap gap-4">
                                    <div class="flex items-center space-x-6 text-sm">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-tv-blue rounded-full"></div>
                                            <span class="text-tv-text-secondary">Ïã§Ï†ú Í∞ÄÍ≤©</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-tv-green rounded-full"></div>
                                            <span class="text-tv-text-secondary">ÏòàÏ∏° ÏßÄÏ†ê</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-1 bg-tv-green rounded-full"></div>
                                            <span class="text-tv-text-secondary">ÏòàÏ∏° ÎùºÏù∏</span>
                                        </div>
                                    </div>
                                    <div class="text-sm text-tv-text-secondary">
                                        <span id="currentPriceDisplay">ÌòÑÏû¨Í∞Ä: -</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Predictions Summary -->
                        <div id="predictionsPanel" class="hidden bg-tv-light/30 border border-tv-border rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-semibold text-tv-text">
                                    <i class="fas fa-list text-tv-green mr-2"></i>ÏÑ§Ï†ïÎêú ÏòàÏ∏°
                                </h4>
                                <span id="predictionCount" class="text-sm text-tv-text-secondary">0Í∞ú ÏòàÏ∏°</span>
                            </div>
                            <div id="predictionsList" class="space-y-2 max-h-32 overflow-y-auto">
                                <!-- Predictions will be dynamically added here -->
                            </div>
                        </div>
                    </div>

                    <!-- Optional: Analysis/Reasoning -->
                    <div class="space-y-4">
                        <label class="block text-lg font-semibold text-tv-text">
                            <i class="fas fa-lightbulb text-orange-500 mr-2"></i>ÏòàÏ∏° Í∑ºÍ±∞ (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                        </label>

                        <textarea id="predictionReason" name="reasoning" rows="3"
                            class="w-full px-4 py-3 bg-tv-light border border-tv-border rounded-lg text-tv-text focus:ring-2 focus:ring-tv-blue focus:border-tv-blue transition-all resize-none"
                            placeholder="ÏòàÏ∏°Ïùò Í∑ºÍ±∞ÎÇò Î∂ÑÏÑù ÎÇ¥Ïö©ÏùÑ Í∞ÑÎã®Ìûà ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî (ÏÑ†ÌÉùÏÇ¨Ìï≠)"></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-6">
                        <button type="submit" id="submitPrediction"
                            class="w-full bg-gradient-to-r from-tv-blue to-blue-600 hover:from-blue-600 hover:to-tv-blue text-white font-bold py-4 px-8 rounded-lg transition-all duration-300 transform hover:scale-[1.02] hover:shadow-lg hover:shadow-tv-blue/20 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:shadow-none">
                            <i class="fas fa-rocket mr-2"></i>
                            <span id="submitButtonText">ÏòàÏ∏° Î∞úÌñâÌïòÍ∏∞</span>
                        </button>
                    </div>

                </form>
            </div>

            <!-- Success Message -->
            <div id="successMessage"
                class="hidden mt-8 bg-tv-green/20 border border-tv-green/30 rounded-lg p-6 text-center">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-16 h-16 bg-tv-green/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-check text-tv-green text-2xl"></i>
                    </div>
                </div>
                <h3 class="text-xl font-bold text-tv-green mb-2">ÏòàÏ∏°Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∞úÌñâÎêòÏóàÏäµÎãàÎã§!</h3>
                <p class="text-tv-text-secondary mb-4">ÏòàÏ∏°Ïù¥ Ï†ÄÏû•ÎêòÏóàÏúºÎ©∞ Îã§Î•∏ ÏÇ¨Ïö©ÏûêÎì§Ïù¥ Î≥º Ïàò ÏûàÏäµÎãàÎã§.</p>
                <div class="flex gap-4 justify-center">
                    <button onclick="resetForm()"
                        class="bg-tv-blue hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                        ÏÉà ÏòàÏ∏° ÏûëÏÑ±
                    </button>
                    <a href="my-predictions.html"
                        class="bg-tv-green hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors">
                        ÎÇ¥ ÏòàÏ∏° Î≥¥Í∏∞
                    </a>
                </div>
            </div>

            <!-- API Status Panel -->
            <div id="apiStatusPanel" class="mt-8 bg-tv-card border border-tv-border rounded-lg overflow-hidden">
                <div class="bg-tv-light border-b border-tv-border p-4 flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-tv-text">
                        <i class="fas fa-server text-tv-blue mr-2"></i>API ÏÉÅÌÉú
                    </h3>
                    <button onclick="checkApiStatus()"
                        class="px-3 py-1 bg-tv-blue/20 border border-tv-blue/30 text-tv-blue rounded text-sm hover:bg-tv-blue/30 transition-colors">
                        <i class="fas fa-refresh mr-1"></i>ÏÉàÎ°úÍ≥†Ïπ®
                    </button>
                </div>
                <div class="p-4">
                    <div id="apiStatusContent" class="space-y-3">
                        <div class="text-center text-tv-text-secondary py-4">
                            <i class="fas fa-spinner fa-spin text-tv-blue text-xl mb-2"></i>
                            <p>API ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // Global variables
        let chart = null;
        let volumeChart = null;
        let stockData = [];
        let volumeData = [];
        let currentStockSymbol = '';
        let predictions = [];
        let isDragging = false;
        let currentInterval = '1d';
        let chartScrollPosition = 100; // 100% means showing latest data
        let hoveredPredictionPoint = null;

        // DOM elements
        const stockSelect = document.getElementById('stockSelect');
        const stockSearch = document.getElementById('stockSearch');
        const stockSearchInput = document.getElementById('stockSearchInput');
        const chartScrollbar = document.getElementById('chartScrollbar');
        const timeIntervalBtns = document.querySelectorAll('.time-interval-btn');
        const showVolumeCheckbox = document.getElementById('showVolume');
        const volumeContainer = document.getElementById('volumeContainer');
        const resetZoomBtn = document.getElementById('resetZoom');
        const predictionTooltip = document.getElementById('predictionTooltip');
        const deletePredictionBtn = document.getElementById('deletePredictionBtn');
        const stockInfo = document.getElementById('stockInfo');
        const chartContainer = document.getElementById('chartContainer');
        const chartCanvas = document.getElementById('predictionChart');
        const chartLoading = document.getElementById('chartLoading');
        const noStockSelected = document.getElementById('noStockSelected');
        const chartTimeRange = document.getElementById('chartTimeRange');
        const clearPredictions = document.getElementById('clearPredictions');
        const fitChart = document.getElementById('fitChart');
        const predictionsPanel = document.getElementById('predictionsPanel');
        const predictionsList = document.getElementById('predictionsList');
        const predictionCount = document.getElementById('predictionCount');
        const currentPriceDisplay = document.getElementById('currentPriceDisplay');
        const submitButton = document.getElementById('submitPrediction');
        const submitButtonText = document.getElementById('submitButtonText');
        const predictionForm = document.getElementById('predictionForm');
        const successMessage = document.getElementById('successMessage');
        const selectedStockName = document.getElementById('selectedStockName');
        const selectedStockSymbol = document.getElementById('selectedStockSymbol');
        const currentStockPrice = document.getElementById('currentStockPrice');
        const loadingPrice = document.getElementById('loadingPrice');

        // Function to determine market type based on symbol
        function getMarketType(symbol) {
            if (symbol.includes('-USD') || ['BTC', 'ETH', 'BNB', 'ADA', 'SOL', 'XRP', 'DOT', 'DOGE', 'AVAX', 'SHIB', 'MATIC', 'LTC', 'UNI', 'LINK', 'ATOM'].includes(symbol.split('-')[0])) {
                return 'crypto';
            } else if (symbol.includes('.KS')) {
                return 'kr_stock';
            } else if (symbol.includes('.T')) {
                return 'jp_stock';
            } else if (symbol.includes('.NS') || symbol.includes('.BO')) {
                return 'in_stock';
            } else if (symbol.includes('.L')) {
                return 'uk_stock';
            } else if (symbol.includes('.TO')) {
                return 'ca_stock';
            } else if (symbol.includes('.PA')) {
                return 'fr_stock';
            } else if (symbol.includes('.DE')) {
                return 'de_stock';
            } else if (symbol.includes('.TW')) {
                return 'tw_stock';
            } else {
                return 'us_stock';
            }
        }

        // Initialize chart
        function initializeChart() {
            const ctx = chartCanvas.getContext('2d');

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Ïã§Ï†ú Í∞ÄÍ≤©',
                            data: [],
                            borderColor: '#2962ff',
                            backgroundColor: 'rgba(41, 98, 255, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            pointRadius: 0,
                            pointHoverRadius: 5,
                            tension: 0.1
                        },
                        {
                            label: 'ÏòàÏ∏°',
                            data: [],
                            borderColor: '#26a69a',
                            backgroundColor: '#26a69a',
                            borderWidth: 2,
                            fill: false,
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            borderDash: [5, 5],
                            showLine: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 34, 45, 0.95)',
                            titleColor: '#d1d4dc',
                            bodyColor: '#d1d4dc',
                            borderColor: '#363a45',
                            borderWidth: 1,
                            callbacks: {
                                title: function (context) {
                                    if (context[0]) {
                                        return new Date(context[0].parsed.x).toLocaleDateString('ko-KR');
                                    }
                                },
                                label: function (context) {
                                    return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        },
                        zoom: {
                            limits: {
                                x: { min: 'original', max: 'original' },
                                y: { min: 'original', max: 'original' }
                            },
                            pan: {
                                enabled: true,
                                mode: 'x',
                                threshold: 10
                            },
                            zoom: {
                                wheel: {
                                    enabled: true,
                                },
                                pinch: {
                                    enabled: true
                                },
                                mode: 'x',
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    minute: 'HH:mm',
                                    hour: 'HH:mm',
                                    day: 'MMM dd',
                                    week: 'MMM dd',
                                    month: 'MMM yyyy'
                                }
                            },
                            grid: {
                                color: function (context) {
                                    // Make grid lines more visible for date separation
                                    return context.tick.major ? '#4a5568' : '#363a45';
                                },
                                drawBorder: false,
                                lineWidth: function (context) {
                                    return context.tick.major ? 2 : 1;
                                }
                            },
                            ticks: {
                                color: '#868993',
                                maxTicksLimit: 8,
                                major: {
                                    enabled: true
                                }
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: '#363a45',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#868993',
                                callback: function (value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    onClick: handleChartClick,
                    onHover: handleChartHover
                }
            });

            // Initialize volume chart
            initializeVolumeChart();
        }

        // Initialize volume chart
        function initializeVolumeChart() {
            const volumeCtx = document.getElementById('volumeChart').getContext('2d');

            volumeChart = new Chart(volumeCtx, {
                type: 'bar',
                data: {
                    datasets: [{
                        label: 'Í±∞ÎûòÎüâ',
                        data: [],
                        backgroundColor: function (context) {
                            // Color bars based on price movement
                            const index = context.dataIndex;
                            if (stockData.length > index + 1) {
                                const current = stockData[index];
                                const previous = stockData[index - 1];
                                if (current && previous) {
                                    return current.close > previous.close ? '#26a69a' : '#ef5350';
                                }
                            }
                            return '#64748b';
                        },
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(30, 34, 45, 0.95)',
                            titleColor: '#d1d4dc',
                            bodyColor: '#d1d4dc',
                            borderColor: '#363a45',
                            borderWidth: 1,
                            callbacks: {
                                title: function (context) {
                                    if (context[0]) {
                                        return new Date(context[0].parsed.x).toLocaleDateString('ko-KR');
                                    }
                                },
                                label: function (context) {
                                    return `Í±∞ÎûòÎüâ: ${formatVolume(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            display: false
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#363a45',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#868993',
                                maxTicksLimit: 3,
                                callback: function (value) {
                                    return formatVolume(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Format volume numbers
        function formatVolume(value) {
            if (value >= 1000000000) {
                return (value / 1000000000).toFixed(1) + 'B';
            } else if (value >= 1000000) {
                return (value / 1000000).toFixed(1) + 'M';
            } else if (value >= 1000) {
                return (value / 1000).toFixed(1) + 'K';
            }
            return value.toString();
        }

        // Handle chart click for predictions
        function handleChartClick(event, elements) {
            if (!currentStockSymbol) return;

            const canvasPosition = Chart.helpers.getRelativePosition(event, chart);
            const dataX = chart.scales.x.getValueForPixel(canvasPosition.x);
            const dataY = chart.scales.y.getValueForPixel(canvasPosition.y);

            const clickDate = new Date(dataX);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Only allow predictions for future dates
            if (clickDate <= today) {
                showMessage('ÎØ∏Îûò ÎÇ†ÏßúÏóêÎßå ÏòàÏ∏°ÏùÑ ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.', 'warning');
                return;
            }

            // Check if there's already a prediction for this date (within 1 day tolerance)
            const existingPredictionIndex = predictions.findIndex(p => {
                const predDate = new Date(p.date);
                const diffDays = Math.abs((predDate - clickDate) / (1000 * 60 * 60 * 24));
                return diffDays < 1;
            });

            if (existingPredictionIndex >= 0) {
                // Update existing prediction
                predictions[existingPredictionIndex].price = dataY;
                predictions[existingPredictionIndex].date = clickDate.toISOString();
            } else {
                // Add new prediction
                predictions.push({
                    date: clickDate.toISOString(),
                    price: dataY,
                    id: Date.now()
                });
            }

            updateChart();
            updatePredictionsList();
            showMessage(`ÏòàÏ∏° ÏÑ§Ï†ï: ${clickDate.toLocaleDateString('ko-KR')} - $${dataY.toFixed(2)}`, 'info');
        }

        // Handle chart hover for prediction tooltips
        function handleChartHover(event, activeElements) {
            const canvasPosition = Chart.helpers.getRelativePosition(event, chart);

            // Check if hovering over a prediction point
            if (activeElements.length > 0) {
                const element = activeElements[0];
                if (element.datasetIndex === 1) { // Prediction dataset
                    const prediction = predictions[element.index];
                    if (prediction) {
                        showPredictionTooltip(event, prediction);
                        hoveredPredictionPoint = prediction;
                        chartCanvas.style.cursor = 'pointer';
                        return;
                    }
                }
            }

            // Hide tooltip if not hovering over prediction
            hidePredictionTooltip();
            hoveredPredictionPoint = null;
            chartCanvas.style.cursor = 'crosshair';
        }

        // Show prediction tooltip
        function showPredictionTooltip(event, prediction) {
            const rect = chartCanvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            document.getElementById('tooltipDate').textContent = new Date(prediction.date).toLocaleDateString('ko-KR');
            document.getElementById('tooltipPrice').textContent = '$' + prediction.price.toFixed(2);

            predictionTooltip.style.left = (x + 10) + 'px';
            predictionTooltip.style.top = (y - 10) + 'px';
            predictionTooltip.classList.remove('hidden');
        }

        // Hide prediction tooltip
        function hidePredictionTooltip() {
            predictionTooltip.classList.add('hidden');
        }

        // Update chart with predictions
        function updateChart() {
            if (!chart) return;

            // Update prediction points
            chart.data.datasets[1].data = predictions.map(p => ({
                x: new Date(p.date),
                y: p.price
            }));

            chart.update('none');
        }

        // Update predictions list display
        function updatePredictionsList() {
            if (predictions.length === 0) {
                predictionsPanel.classList.add('hidden');
                return;
            }

            predictionsPanel.classList.remove('hidden');
            predictionCount.textContent = `${predictions.length}Í∞ú ÏòàÏ∏°`;

            predictionsList.innerHTML = predictions
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .map(p => {
                    const date = new Date(p.date);
                    const currentPrice = getCurrentPrice();
                    const change = currentPrice ? ((p.price - currentPrice) / currentPrice * 100) : 0;
                    const changeClass = change >= 0 ? 'text-tv-green' : 'text-tv-red';
                    const changeIcon = change >= 0 ? 'üìà' : 'üìâ';

                    return `
                        <div class="flex items-center justify-between p-3 bg-tv-card rounded-lg border border-tv-border">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-medium text-tv-text">${date.toLocaleDateString('ko-KR')}</span>
                                    <span class="text-xs text-tv-text-secondary">${date.toLocaleDateString('ko-KR', { weekday: 'short' })}</span>
                                </div>
                                <div class="flex items-center space-x-2 mt-1">
                                    <span class="text-lg font-bold text-tv-text">$${p.price.toFixed(2)}</span>
                                    <span class="${changeClass} text-sm font-medium">
                                        ${changeIcon} ${change >= 0 ? '+' : ''}${change.toFixed(2)}%
                                    </span>
                                </div>
                            </div>
                            <button onclick="removePrediction(${p.id})" class="ml-3 text-tv-red hover:text-red-400 transition-colors">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                }).join('');
        }

        // Remove prediction
        function removePrediction(id) {
            predictions = predictions.filter(p => p.id !== id);
            updateChart();
            updatePredictionsList();
        }

        // Clear all predictions
        clearPredictions.addEventListener('click', () => {
            predictions = [];
            updateChart();
            updatePredictionsList();
            showMessage('Î™®Îì† ÏòàÏ∏°Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'info');
        });

        // Fit chart to show all data
        fitChart.addEventListener('click', () => {
            if (chart && stockData.length > 0) {
                const minPrice = Math.min(...stockData.map(d => d.y));
                const maxPrice = Math.max(...stockData.map(d => d.y));
                const padding = (maxPrice - minPrice) * 0.1;

                chart.options.scales.y.min = minPrice - padding;
                chart.options.scales.y.max = maxPrice + padding;
                chart.update();
            }
        });

        // Get current price
        function getCurrentPrice() {
            if (stockData.length === 0) return 0;
            return stockData[stockData.length - 1].y;
        }

        // Load stock data
        async function loadStockData(symbol) {
            if (!symbol) return;

            chartLoading.style.display = 'flex';
            noStockSelected.style.display = 'none';

            try {
                // Get number of days for historical data
                const days = parseInt(chartTimeRange.value) || 90;

                // Show detailed loading information
                console.log(`Loading data for ${symbol}, ${days} days, interval: ${currentInterval}`);

                // Fetch real data from API only - no fallback to mock data
                const data = await fetchRealStockData(symbol, days, currentInterval);
                console.log(`Received ${data.length} price data points`);

                // Also fetch volume data
                const volumeApiData = await fetchRealVolumeData(symbol, days, currentInterval);
                console.log(`Received ${volumeApiData.length} volume data points`);

                stockData = data;
                volumeData = volumeApiData || []; // Handle empty volume data gracefully
                currentStockSymbol = symbol;

                // Validate that we have data
                if (!stockData || stockData.length === 0) {
                    throw new Error('No price data received from API');
                }                // Update chart
                if (chart) {
                    chart.data.datasets[0].data = stockData;

                    // Extend chart range to show future dates
                    const lastDate = new Date(stockData[stockData.length - 1].x);
                    const futureDate = new Date(lastDate);
                    futureDate.setDate(futureDate.getDate() + 30); // Show 30 days into future

                    chart.options.scales.x.max = futureDate;
                    chart.update();
                }

                // Update volume chart if enabled
                if (showVolumeCheckbox.checked && volumeChart) {
                    updateVolumeChart();
                }

                // Update current price display
                const currentPrice = getCurrentPrice();
                currentPriceDisplay.textContent = `ÌòÑÏû¨Í∞Ä: $${currentPrice.toFixed(2)}`;

                // Update stock info
                selectedStockName.textContent = getStockDisplayName(symbol);
                selectedStockSymbol.textContent = symbol;
                currentStockPrice.textContent = `$${currentPrice.toFixed(2)}`;
                currentStockPrice.className = 'text-3xl font-bold text-tv-text';
                stockInfo.classList.remove('hidden');

                // Reset scrollbar to show latest data
                chartScrollbar.value = 100;
                chartScrollPosition = 100;
                updateChartView();

                chartLoading.style.display = 'none';

            } catch (error) {
                console.error('Error loading stock data:', error);
                chartLoading.style.display = 'none';

                // Provide more specific error messages
                let errorMessage = 'Îç∞Ïù¥ÌÑ∞ Î°úÎî©Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§';

                if (error.message.includes('404')) {
                    errorMessage = 'Ìï¥Îãπ Ï¢ÖÎ™©Ïùò Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§';
                } else if (error.message.includes('500')) {
                    errorMessage = 'ÏÑúÎ≤Ñ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî';
                } else {
                    errorMessage = `Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®: ${error.message}`;
                }

                showMessage(errorMessage, 'error');

                // Show the no data state
                noStockSelected.style.display = 'flex';
                stockInfo.classList.add('hidden');

                // Clear any existing chart data
                if (chart) {
                    chart.data.datasets[0].data = [];
                    chart.data.datasets[1].data = [];
                    chart.update();
                }

                if (volumeChart) {
                    volumeChart.data.datasets[0].data = [];
                    volumeChart.update();
                }

                // Reset variables
                stockData = [];
                volumeData = [];
                currentStockSymbol = '';
            }
        }

        // Fetch real stock data from API
        async function fetchRealStockData(symbol, days, interval = '1d') {
            const market = getMarketType(symbol);

            // First try to get current quote to verify symbol exists
            let currentQuote;
            try {
                const quoteResponse = await fetch(`/api/market-data/quote/${encodeURIComponent(symbol)}/?market=${market}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (quoteResponse.ok) {
                    currentQuote = await quoteResponse.json();
                }
            } catch (error) {
                console.log('Quote fetch failed:', error);
            }

            // Try different endpoints for historical data based on market type
            let historyEndpoints = [];

            if (market === 'crypto') {
                historyEndpoints = [
                    `/api/market-data/coingecko/${symbol}/`,
                    `/api/market-data/crypto/${symbol}/`,
                    `/api/market-data/historical/${symbol}/?market=${market}`,
                ];
            } else {
                historyEndpoints = [
                    `/api/market-data/historical/${symbol}/?market=${market}&days=${days}&interval=${interval}`,
                    `/api/market-data/enhanced/${symbol}/`,
                    `/api/market-data/tiingo/${symbol}/`,
                    `/api/market-data/marketstack/${symbol}/`,
                ];
            }

            // Try each endpoint until one works
            for (const endpoint of historyEndpoints) {
                try {
                    console.log(`Trying endpoint: ${endpoint}`);
                    const response = await fetch(endpoint, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (response.ok) {
                        const data = await response.json();
                        console.log('Raw API response:', data);

                        // Handle different response formats
                        let historicalData = null;

                        // CoinGecko format
                        if (data.prices && Array.isArray(data.prices)) {
                            historicalData = data.prices.map((item, index) => {
                                const timestamp = Array.isArray(item) ? item[0] : item.timestamp;
                                const price = Array.isArray(item) ? item[1] : item.price;
                                const volume = data.total_volumes && data.total_volumes[index] ?
                                    (Array.isArray(data.total_volumes[index]) ? data.total_volumes[index][1] : data.total_volumes[index]) : 0;

                                return {
                                    x: new Date(timestamp),
                                    y: price,
                                    volume: volume
                                };
                            });
                        }
                        // Standard historical_data format
                        else if (data.historical_data && Array.isArray(data.historical_data)) {
                            historicalData = data.historical_data.map(item => ({
                                x: new Date(item.date),
                                y: item.price || item.close || item.value,
                                volume: item.volume || 0
                            }));
                        }
                        // Single data point with current quote
                        else if (currentQuote && (data.current_price || data.price || data.close)) {
                            // Generate some basic historical data if only current quote is available
                            historicalData = generateBasicHistoryFromQuote(currentQuote, days);
                        }

                        if (historicalData && historicalData.length > 0) {
                            console.log(`Successfully got ${historicalData.length} data points from ${endpoint}`);
                            return historicalData;
                        }
                    }
                } catch (error) {
                    console.log(`Endpoint ${endpoint} failed:`, error.message);
                    continue;
                }
            }

            // If all endpoints fail, throw error
            throw new Error(`No historical data available for ${symbol}. Tried ${historyEndpoints.length} endpoints.`);
        }

        // Generate basic historical data from current quote (fallback)
        function generateBasicHistoryFromQuote(quote, days) {
            const data = [];
            const currentPrice = quote.current_price || quote.price || quote.close || 100;
            const endDate = new Date();

            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(endDate);
                date.setDate(date.getDate() - i);

                // Add some variation to make it look realistic (¬±2% daily change)
                const variation = (Math.random() - 0.5) * 0.04; // -2% to +2%
                const dayPrice = currentPrice * (1 + variation * (i / days));

                data.push({
                    x: date,
                    y: Math.max(dayPrice, 0.01), // Ensure positive price
                    volume: Math.floor(Math.random() * 1000000) + 100000 // Random volume
                });
            }

            return data;
        }

        // Fetch real volume data from API 
        async function fetchRealVolumeData(symbol, days, interval = '1d') {
            // Volume data is typically included in the main stock data response
            // So we'll extract it from there instead of making a separate call
            try {
                const market = getMarketType(symbol);

                // For crypto, try CoinGecko first which includes volume
                if (market === 'crypto') {
                    const response = await fetch(`/api/market-data/coingecko/${symbol}/`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (response.ok) {
                        const data = await response.json();

                        if (data.total_volumes && Array.isArray(data.total_volumes)) {
                            return data.total_volumes.map(item => ({
                                x: new Date(Array.isArray(item) ? item[0] : item.timestamp),
                                y: Array.isArray(item) ? item[1] : item.volume
                            }));
                        }
                    }
                }

                // For stocks, try to get volume from quote API or generate basic volume data
                const quoteResponse = await fetch(`/api/market-data/quote/${encodeURIComponent(symbol)}/?market=${market}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (quoteResponse.ok) {
                    const quoteData = await quoteResponse.json();

                    // Generate volume data based on current volume or typical ranges
                    const baseVolume = quoteData.volume || 1000000;
                    const volumeData = [];
                    const endDate = new Date();

                    for (let i = days - 1; i >= 0; i--) {
                        const date = new Date(endDate);
                        date.setDate(date.getDate() - i);

                        // Generate realistic volume (¬±50% of base volume)
                        const volumeVariation = (Math.random() - 0.5) * 1.0; // -50% to +50%
                        const dayVolume = Math.floor(baseVolume * (1 + volumeVariation));

                        volumeData.push({
                            x: date,
                            y: Math.max(dayVolume, 1000) // Minimum 1000 volume
                        });
                    }

                    return volumeData;
                }

                // If everything fails, return empty array
                console.log('No volume data available, returning empty array');
                return [];

            } catch (error) {
                console.log('Volume data fetch failed:', error);
                return []; // Return empty array instead of throwing error
            }
        }

        // Get stock display name
        function getStockDisplayName(symbol) {
            const option = stockSelect.querySelector(`option[value="${symbol}"]`);
            return option ? option.textContent.split(' - ')[1] || option.textContent : symbol;
        }

        // Show message
        function showMessage(message, type = 'info') {
            // Create a temporary message element
            const messageEl = document.createElement('div');
            messageEl.className = `fixed top-4 right-4 z-50 p-4 rounded-lg border max-w-sm ${type === 'error' ? 'bg-tv-red/20 border-tv-red/30 text-tv-red' :
                type === 'warning' ? 'bg-orange-500/20 border-orange-500/30 text-orange-500' :
                    'bg-tv-blue/20 border-tv-blue/30 text-tv-blue'
                }`;
            messageEl.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(messageEl);

            setTimeout(() => {
                messageEl.remove();
            }, 3000);
        }

        // Stock selection handler
        stockSelect.addEventListener('change', function () {
            const symbol = this.value;
            if (symbol) {
                loadStockData(symbol);
                predictions = []; // Clear previous predictions
                updatePredictionsList();
            } else {
                stockInfo.classList.add('hidden');
                noStockSelected.style.display = 'flex';
                chartLoading.style.display = 'none';
                currentStockSymbol = '';
                predictions = [];
                updatePredictionsList();
                if (chart) {
                    chart.data.datasets[0].data = [];
                    chart.data.datasets[1].data = [];
                    chart.update();
                }
            }
        });

        // Chart time range handler
        chartTimeRange.addEventListener('change', function () {
            if (currentStockSymbol) {
                loadStockData(currentStockSymbol);
            }
        });

        // Stock search functionality
        stockSearch.addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase();
            const options = stockSelect.querySelectorAll('option');

            options.forEach(option => {
                if (option.value === '') return;

                const text = option.textContent.toLowerCase();
                const value = option.value.toLowerCase();

                if (text.includes(searchTerm) || value.includes(searchTerm)) {
                    option.style.display = '';
                } else {
                    option.style.display = 'none';
                }
            });
        });

        // Enhanced stock search input functionality
        stockSearchInput.addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase();
            const options = stockSelect.querySelectorAll('option');
            let matchFound = false;

            options.forEach(option => {
                if (option.value === '') return;

                const text = option.textContent.toLowerCase();
                const value = option.value.toLowerCase();

                if (text.includes(searchTerm) || value.includes(searchTerm)) {
                    if (!matchFound) {
                        // Auto-select first match
                        stockSelect.value = option.value;
                        stockSelect.dispatchEvent(new Event('change'));
                        matchFound = true;
                    }
                }
            });
        });

        // Time interval button handlers
        timeIntervalBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                // Update active button
                timeIntervalBtns.forEach(b => {
                    b.classList.remove('bg-tv-blue', 'text-white');
                    b.classList.add('text-tv-text-secondary', 'hover:text-tv-text', 'hover:bg-tv-light');
                });

                this.classList.add('bg-tv-blue', 'text-white');
                this.classList.remove('text-tv-text-secondary', 'hover:text-tv-text', 'hover:bg-tv-light');

                currentInterval = this.dataset.interval;

                // Update chart time unit based on interval
                if (chart) {
                    let timeUnit = 'day';
                    switch (currentInterval) {
                        case '1m':
                        case '5m':
                            timeUnit = 'minute';
                            break;
                        case '1h':
                            timeUnit = 'hour';
                            break;
                        case '1d':
                            timeUnit = 'day';
                            break;
                        case '1wk':
                            timeUnit = 'week';
                            break;
                        case '1mo':
                            timeUnit = 'month';
                            break;
                    }

                    chart.options.scales.x.time.unit = timeUnit;
                    chart.update();
                }

                // Reload data with new interval if stock is selected
                if (currentStockSymbol) {
                    loadStockData(currentStockSymbol);
                }
            });
        });

        // Chart scrollbar handler
        chartScrollbar.addEventListener('input', function () {
            chartScrollPosition = parseInt(this.value);
            updateChartView();
        });

        // Update chart view based on scroll position
        function updateChartView() {
            if (!chart || stockData.length === 0) return;

            const totalDataPoints = stockData.length;
            const visiblePoints = Math.min(50, totalDataPoints); // Show maximum 50 points at once

            // Calculate the start index based on scroll position
            const maxStartIndex = Math.max(0, totalDataPoints - visiblePoints);
            const startIndex = Math.floor((chartScrollPosition / 100) * maxStartIndex);
            const endIndex = Math.min(startIndex + visiblePoints, totalDataPoints);

            // Update chart data to show only the selected range
            const visibleData = stockData.slice(startIndex, endIndex);
            chart.data.datasets[0].data = visibleData;

            // Add future dates for predictions (extend 30 days into future)
            if (chartScrollPosition === 100) {
                const lastDate = new Date(stockData[stockData.length - 1].x);
                const futureData = [];
                for (let i = 1; i <= 30; i++) {
                    const futureDate = new Date(lastDate);
                    futureDate.setDate(futureDate.getDate() + i);
                    futureData.push({
                        x: futureDate,
                        y: null // No price data for future dates
                    });
                }
                chart.data.datasets[0].data = [...visibleData, ...futureData];
            }

            chart.update('none');

            // Update volume chart if visible
            if (volumeChart && showVolumeCheckbox.checked) {
                const visibleVolumeData = volumeData.slice(startIndex, endIndex);
                volumeChart.data.datasets[0].data = visibleVolumeData;
                volumeChart.update('none');
            }
        }

        // Volume toggle handler
        showVolumeCheckbox.addEventListener('change', function () {
            if (this.checked) {
                volumeContainer.style.display = 'block';
                updateVolumeChart();
            } else {
                volumeContainer.style.display = 'none';
            }
        });

        // Update volume chart with current data
        function updateVolumeChart() {
            if (!volumeChart || volumeData.length === 0) return;

            volumeChart.data.datasets[0].data = volumeData;
            volumeChart.update();
        }

        // Reset zoom handler
        resetZoomBtn.addEventListener('click', function () {
            if (chart) {
                chart.resetZoom();
                showMessage('Ï∞®Ìä∏ Ï§åÏù¥ Î¶¨ÏÖãÎêòÏóàÏäµÎãàÎã§.', 'info');
            }
        });

        // Delete prediction from tooltip
        deletePredictionBtn.addEventListener('click', function () {
            if (hoveredPredictionPoint) {
                removePrediction(hoveredPredictionPoint.id);
                hidePredictionTooltip();
                showMessage('ÏòàÏ∏°Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'info');
            }
        });

        // Form submission handler
        predictionForm.addEventListener('submit', async function (e) {
            e.preventDefault();

            if (predictions.length === 0) {
                showMessage('Ï∞®Ìä∏ÏóêÏÑú ÏòàÏ∏°ÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                return;
            }

            // Disable submit button
            submitButton.disabled = true;
            submitButtonText.textContent = 'Î∞úÌñâ Ï§ë...';
            submitButton.querySelector('i').className = 'fas fa-spinner fa-spin mr-2';

            try {
                const currentPrice = getCurrentPrice();

                // Create predictions for each point
                for (const prediction of predictions) {
                    const formData = {
                        stock_symbol: currentStockSymbol,
                        current_price: currentPrice,
                        predicted_price: prediction.price,
                        target_date: new Date(prediction.date).toISOString().split('T')[0],
                        reasoning: `Chart-based prediction for ${currentStockSymbol}`,
                        confidence: 75
                    };

                    console.log('Submitting prediction:', formData);

                    const response = await fetch('/api/charts/predictions/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCookie('csrftoken') || '',
                        },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.detail || 'Failed to create prediction');
                    }
                }

                // Show success message
                predictionForm.style.display = 'none';
                successMessage.classList.remove('hidden');

            } catch (error) {
                console.error('Error submitting predictions:', error);
                showMessage('ÏòàÏ∏° Î∞úÌñâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
            } finally {
                // Re-enable submit button
                submitButton.disabled = false;
                submitButtonText.textContent = 'ÏòàÏ∏° Î∞úÌñâÌïòÍ∏∞';
                submitButton.querySelector('i').className = 'fas fa-rocket mr-2';
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function () {
            initializeChart();
            noStockSelected.style.display = 'flex';
            chartLoading.style.display = 'none';
            console.log('Interactive prediction chart initialized');
        });

        // CSRF Token helper function
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Reset form function
        function resetForm() {
            predictionForm.reset();
            stockInfo.classList.add('hidden');
            predictionsPanel.classList.add('hidden');
            successMessage.classList.add('hidden');
            predictionForm.style.display = 'block';
            predictions = [];
            currentStockSymbol = '';
            if (chart) {
                chart.data.datasets[0].data = [];
                chart.data.datasets[1].data = [];
                chart.update();
            }
            noStockSelected.style.display = 'flex';
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuButton = document.getElementById('mobileMenuButton');

            if (mobileMenu.classList.contains('translate-x-full')) {
                // Open menu
                mobileMenu.classList.remove('translate-x-full');
                mobileMenu.classList.add('translate-x-0');
                mobileMenuButton.classList.add('menu-open');
                document.body.style.overflow = 'hidden';
            } else {
                // Close menu
                mobileMenu.classList.remove('translate-x-0');
                mobileMenu.classList.add('translate-x-full');
                mobileMenuButton.classList.remove('menu-open');
                document.body.style.overflow = 'auto';
            }
        }

        // Login modal function (placeholder)
        function showLoginModal() {
            alert('Î°úÍ∑∏Ïù∏ Í∏∞Îä•ÏùÄ Í≥ß Íµ¨ÌòÑÎê† ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        // Add hamburger menu animation styles
        const style = document.createElement('style');
        style.textContent = `
            .hamburger-line {
                transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }
            
            .menu-open .hamburger-line:nth-child(1) {
                transform: rotate(45deg) translate(6px, 6px);
            }
            
            .menu-open .hamburger-line:nth-child(2) {
                opacity: 0;
                transform: scale(0);
            }
            
            .menu-open .hamburger-line:nth-child(3) {
                transform: rotate(-45deg) translate(6px, -6px);
            }

            /* Time interval buttons */
            .time-interval-btn {
                color: #868993;
                background: transparent;
            }
            
            .time-interval-btn:hover {
                color: #d1d4dc;
                background: rgba(42, 46, 57, 0.7);
            }
            
            .time-interval-btn.active {
                background: #2962ff !important;
                color: white !important;
            }

            /* Custom scrollbar styling */
            #chartScrollbar {
                background: transparent;
                outline: none;
            }
            
            #chartScrollbar::-webkit-slider-track {
                background: #363a45;
                border-radius: 4px;
                height: 8px;
            }
            
            #chartScrollbar::-webkit-slider-thumb {
                appearance: none;
                width: 20px;
                height: 8px;
                border-radius: 4px;
                background: #2962ff;
                cursor: pointer;
            }
            
            #chartScrollbar::-webkit-slider-thumb:hover {
                background: #1e40af;
            }

            /* Prediction tooltip */
            #predictionTooltip {
                pointer-events: auto;
                backdrop-filter: blur(10px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            }

            /* Enhanced grid lines */
            .chartjs-render-monitor {
                position: relative;
            }

            /* Volume chart styling */
            #volumeContainer {
                transition: all 0.3s ease;
            }
            
            #volumeContainer.hidden {
                height: 0 !important;
                overflow: hidden;
            }

            /* Chart container responsive styles */
            @media (max-width: 768px) {
                #chartContainer .relative:first-child {
                    height: 350px !important;
                }
                
                #volumeContainer {
                    height: 80px !important;
                }
                
                .chart-controls {
                    flex-direction: column;
                    gap: 8px;
                }
                
                .time-interval-btn {
                    font-size: 12px;
                    padding: 8px 12px;
                }
                
                #predictionTooltip {
                    font-size: 12px;
                    padding: 8px;
                }
            }

            /* Touch-friendly interactions on mobile */
            @media (hover: none) and (pointer: coarse) {
                #predictionChart {
                    cursor: default !important;
                }
                
                .prediction-point {
                    touch-action: manipulation;
                }
                
                #chartScrollbar {
                    height: 12px;
                }
                
                #chartScrollbar::-webkit-slider-thumb {
                    height: 12px;
                    width: 24px;
                }
            }

            /* Enhanced search input */
            #stockSearchInput:focus {
                box-shadow: 0 0 0 2px rgba(41, 98, 255, 0.2);
                transform: translateY(-1px);
            }

            /* Button hover effects */
            .time-interval-btn, button[type="button"] {
                transition: all 0.2s ease;
            }
            
            button[type="button"]:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            }

            /* Volume bars animation */
            #volumeChart {
                transition: opacity 0.3s ease;
            }

            /* Prediction points enhanced styling */
            .chartjs-render-monitor canvas {
                border-radius: 0 0 8px 8px;
            }
        `;
        document.head.appendChild(style);

        // Check API status on page load
        document.addEventListener('DOMContentLoaded', function () {
            checkApiStatus();
        });

        // API Status Functions
        async function checkApiStatus() {
            const apiStatusContent = document.getElementById('apiStatusContent');
            apiStatusContent.innerHTML = `
                <div class="text-center text-tv-text-secondary py-4">
                    <i class="fas fa-spinner fa-spin text-tv-blue text-xl mb-2"></i>
                    <p>API ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...</p>
                </div>
            `;

            try {
                // Use the comprehensive health endpoint
                const response = await fetch('/api/market-data/health/', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    const healthData = await response.json();
                    displayEnhancedApiStatus(healthData);
                } else {
                    // Fallback to individual API tests
                    await fallbackApiStatusCheck();
                }

            } catch (error) {
                console.error('API status check failed:', error);
                await fallbackApiStatusCheck();
            }
        }

        function displayEnhancedApiStatus(healthData) {
            const apiStatusContent = document.getElementById('apiStatusContent');

            const overallStatusIcon = getStatusIcon(healthData.overall_status);
            const overallStatusColor = getStatusColor(healthData.overall_status);

            let html = `
                <div class="space-y-4">
                    <!-- Overall Status -->
                    <div class="bg-tv-card rounded-lg border border-tv-border p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">${overallStatusIcon}</span>
                                <div>
                                    <h3 class="text-lg font-semibold text-tv-text">Ï†ÑÏ≤¥ API ÏÉÅÌÉú</h3>
                                    <p class="text-sm ${overallStatusColor}">
                                        ${healthData.overall_status === 'healthy' ? 'Ï†ïÏÉÅ' :
                    healthData.overall_status === 'degraded' ? 'ÏÑ±Îä• Ï†ÄÌïò' : 'Ïã¨Í∞ÅÌïú Î¨∏Ï†ú'}
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-tv-text">${healthData.online_apis}</div>
                                <div class="text-sm text-tv-text-secondary">APIs ÌôúÏÑ±</div>
                            </div>
                        </div>
                        
                        <div class="mt-3 flex items-center space-x-4 text-sm text-tv-text-secondary">
                            <div>ÏÉÅÌÉú: ${healthData.health_percentage}%</div>
                            <div>ÌèâÍ∑† ÏùëÎãµÏãúÍ∞Ñ: ${healthData.average_response_time_ms}ms</div>
                            <div>ÎßàÏßÄÎßâ ÌôïÏù∏: ${new Date(healthData.last_updated).toLocaleTimeString()}</div>
                        </div>
                    </div>

                    <!-- API Details -->
                    <div class="grid grid-cols-2 gap-3">
            `;

            // Add individual API statuses
            Object.entries(healthData.api_details).forEach(([apiName, details]) => {
                const statusIcon = getApiStatusIcon(details.status);
                const statusColor = getApiStatusColor(details.status);
                const statusText = getApiStatusText(details.status);

                html += `
                    <div class="bg-tv-light rounded-lg border border-tv-border p-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">${statusIcon}</span>
                                <div>
                                    <div class="font-medium text-tv-text capitalize">${apiName}</div>
                                    <div class="text-xs ${statusColor}">${statusText}</div>
                                </div>
                            </div>
                            <div class="text-right text-xs text-tv-text-secondary">
                                ${details.response_time_ms ? `${details.response_time_ms}ms` : '-'}
                            </div>
                        </div>
                        ${details.error ? `<div class="mt-2 text-xs text-tv-red">${details.error}</div>` : ''}
                    </div>
                `;
            });

            html += `
                    </div>

                    <!-- Recommendations -->
                    ${healthData.recommendations && healthData.recommendations.length > 0 ? `
                    <div class="bg-tv-card rounded-lg border border-tv-border p-4">
                        <h4 class="text-sm font-semibold text-tv-text mb-2">Í∂åÏû•ÏÇ¨Ìï≠</h4>
                        <ul class="space-y-1">
                            ${healthData.recommendations.map(rec => `
                                <li class="text-xs text-tv-text-secondary flex items-start space-x-2">
                                    <span class="text-tv-blue">‚Ä¢</span>
                                    <span>${rec}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
            `;

            apiStatusContent.innerHTML = html;
        }

        async function fallbackApiStatusCheck() {
            const apiStatusContent = document.getElementById('apiStatusContent');

            try {
                // Test individual APIs as fallback
                const apiTests = [
                    { name: 'Finnhub', endpoint: '/api/market-data/quote/AAPL/?market=us_stock', type: 'stocks' },
                    { name: 'CoinGecko', endpoint: '/api/market-data/coingecko/BTC/', type: 'crypto' },
                    { name: 'Alpha Vantage', endpoint: '/api/market-data/quote/GOOGL/?market=us_stock', type: 'stocks' },
                    { name: 'Marketstack', endpoint: '/api/market-data/quote/MSFT/?market=us_stock', type: 'stocks' },
                    { name: 'Tiingo', endpoint: '/api/market-data/quote/AMZN/?market=us_stock', type: 'stocks' },
                    { name: 'Twelve Data', endpoint: '/api/market-data/quote/TSLA/?market=us_stock', type: 'stocks' }
                ];

                const results = await Promise.allSettled(
                    apiTests.map(async (api) => {
                        const startTime = Date.now();
                        try {
                            const response = await fetch(api.endpoint, {
                                method: 'GET',
                                headers: { 'Content-Type': 'application/json' }
                            });
                            const responseTime = Date.now() - startTime;
                            return {
                                ...api,
                                status: response.ok ? 'success' : 'error',
                                responseTime: responseTime,
                                statusCode: response.status
                            };
                        } catch (error) {
                            return {
                                ...api,
                                status: 'error',
                                responseTime: Date.now() - startTime,
                                error: error.message
                            };
                        }
                    })
                );

                displayBasicApiStatus(results.map(r => r.value || r.reason));

            } catch (error) {
                console.error('Fallback API status check failed:', error);
                apiStatusContent.innerHTML = `
                    <div class="text-center text-tv-red py-4">
                        <i class="fas fa-exclamation-triangle text-xl mb-2"></i>
                        <p>API ÏÉÅÌÉú ÌôïÏù∏ Ïã§Ìå®</p>
                    </div>
                `;
            }
        }

        function displayApiStatus(results) {
            const apiStatusContent = document.getElementById('apiStatusContent');
            const workingApis = results.filter(r => r.status === 'success').length;
            const totalApis = results.length;

            let statusHtml = `
                <div class="mb-4 p-3 rounded-lg ${workingApis > totalApis / 2 ? 'bg-tv-green/20 border border-tv-green/30' : 'bg-tv-red/20 border border-tv-red/30'}">
                    <div class="flex items-center justify-between">
                        <span class="font-semibold ${workingApis > totalApis / 2 ? 'text-tv-green' : 'text-tv-red'}">
                            <i class="fas fa-${workingApis > totalApis / 2 ? 'check-circle' : 'exclamation-circle'} mr-2"></i>
                            API ÏÉÅÌÉú: ${workingApis}/${totalApis} ÏûëÎèô Ï§ë
                        </span>
                        <span class="text-sm text-tv-text-secondary">
                            ${new Date().toLocaleTimeString('ko-KR')} ÏóÖÎç∞Ïù¥Ìä∏
                        </span>
                    </div>
                </div>
                
                <div class="space-y-2">
            `;

            results.forEach(api => {
                const statusIcon = api.status === 'success' ?
                    '<i class="fas fa-check-circle text-tv-green"></i>' :
                    '<i class="fas fa-times-circle text-tv-red"></i>';

                const statusText = api.status === 'success' ? 'Ï†ïÏÉÅ' : 'Ïò§Î•ò';
                const statusClass = api.status === 'success' ? 'text-tv-green' : 'text-tv-red';

                statusHtml += `
                    <div class="flex items-center justify-between p-3 bg-tv-light rounded-lg">
                        <div class="flex items-center space-x-3">
                            ${statusIcon}
                            <span class="font-medium text-tv-text">${api.name}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-tv-blue/20 text-tv-blue">${api.type}</span>
                        </div>
                        <div class="text-right">
                            <span class="${statusClass} text-sm font-medium">${statusText}</span>
                            ${api.statusCode ? `<span class="text-xs text-tv-text-secondary ml-2">(${api.statusCode})</span>` : ''}
                        </div>
                    </div>
                `;
            });

            statusHtml += '</div>';
            apiStatusContent.innerHTML = statusHtml;
        }

        function displayBasicApiStatus(results) {
            const apiStatusContent = document.getElementById('apiStatusContent');
            const workingApis = results.filter(api => api.status === 'success').length;
            const totalApis = results.length;

            let html = `
                <div class="text-center mb-4">
                    <div class="text-lg font-bold text-tv-text">${workingApis}/${totalApis} APIs ÌôúÏÑ±</div>
                    <div class="text-sm text-tv-text-secondary">ÎßàÏßÄÎßâ ÌôïÏù∏: ${new Date().toLocaleTimeString()}</div>
                </div>
                <div class="space-y-3">
            `;

            results.forEach(api => {
                const statusIcon = api.status === 'success' ? '‚úÖ' : '‚ùå';
                const statusColor = api.status === 'success' ? 'text-tv-green' : 'text-tv-red';

                html += `
                    <div class="flex items-center justify-between p-3 bg-tv-light rounded-lg">
                        <div class="flex items-center space-x-3">
                            <span class="text-lg">${statusIcon}</span>
                            <span class="font-medium text-tv-text">${api.name}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-tv-blue/20 text-tv-blue">${api.type}</span>
                        </div>
                        <div class="text-right">
                            <span class="${statusColor} text-sm font-medium">
                                ${api.status === 'success' ? 'Ï†ïÏÉÅ' : 'Ïò§Î•ò'}
                            </span>
                            ${api.responseTime ? `<div class="text-xs text-tv-text-secondary">${api.responseTime}ms</div>` : ''}
                            ${api.error ? `<div class="text-xs text-tv-red mt-1">${api.error.substring(0, 30)}...</div>` : ''}
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            apiStatusContent.innerHTML = html;
        }

        // Helper functions for enhanced status display
        function getStatusIcon(status) {
            switch (status) {
                case 'healthy': return '‚úÖ';
                case 'degraded': return '‚ö†Ô∏è';
                case 'critical': return 'üî¥';
                default: return '‚ùì';
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case 'healthy': return 'text-tv-green';
                case 'degraded': return 'text-yellow-500';
                case 'critical': return 'text-tv-red';
                default: return 'text-tv-text-secondary';
            }
        }

        function getApiStatusIcon(status) {
            switch (status) {
                case 'online': return '‚úÖ';
                case 'timeout': return '‚è±Ô∏è';
                case 'offline': return '‚ùå';
                case 'api_limit': return '‚ö°';
                case 'error': return 'üî¥';
                default: return '‚ùì';
            }
        }

        function getApiStatusColor(status) {
            switch (status) {
                case 'online': return 'text-tv-green';
                case 'timeout': return 'text-yellow-500';
                case 'offline': return 'text-tv-red';
                case 'api_limit': return 'text-purple-500';
                case 'error': return 'text-tv-red';
                default: return 'text-tv-text-secondary';
            }
        }

        function getApiStatusText(status) {
            switch (status) {
                case 'online': return 'Ï†ïÏÉÅ';
                case 'timeout': return 'ÏùëÎãµ ÏßÄÏó∞';
                case 'offline': return 'Ïò§ÌîÑÎùºÏù∏';
                case 'api_limit': return 'API Ï†úÌïú';
                case 'error': return 'Ïò§Î•ò';
                default: return 'Ïïå Ïàò ÏóÜÏùå';
            }
        }
    </script>
</body>

</html>