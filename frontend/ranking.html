<!DOCTYPE html>
<html lang="ko" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 랭킹 - StockChart</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📈</text></svg>">

    <link rel="stylesheet" href="css/figma-design.css">
    <link rel="stylesheet" href="css/mobile-trading.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body class="home-body">
    <div class="home-desktop desktop-only">
        <header class="dashboard-top-bar">
            <div class="top-brand">
                <div class="brand-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div>
                    <p class="brand-eyebrow">실시간 수익률 보드</p>
                    <h1 class="brand-title">랭킹 대시보드</h1>
                </div>
            </div>

            <nav class="top-nav-links">
                <a href="/" class="top-nav-link">
                    <i class="fas fa-home"></i>
                    <span>홈</span>
                </a>
                <a href="charts.html" class="top-nav-link">
                    <i class="fas fa-chart-area"></i>
                    <span>차트</span>
                </a>
                <a href="prediction.html" class="top-nav-link">
                    <i class="fas fa-magic"></i>
                    <span>예측하기</span>
                </a>
                <a href="my-predictions.html" class="top-nav-link">
                    <i class="fas fa-user-chart"></i>
                    <span>내 예측</span>
                </a>
                <a href="ranking.html" class="top-nav-link active">
                    <i class="fas fa-trophy"></i>
                    <span>랭킹</span>
                </a>
                <a href="events.html" class="top-nav-link">
                    <i class="fas fa-calendar-star"></i>
                    <span>이벤트</span>
                </a>
            </nav>

            <div class="top-actions">
                <div class="search-input-wrap">
                    <i class="fas fa-search"></i>
                    <input id="rankingSearch" class="search-input" type="search" placeholder="사용자 또는 전략 검색">
                </div>
                <button id="downloadRankingBtn" class="ghost-btn">
                    <i class="fas fa-download"></i>
                    데이터 내보내기
                </button>
                <button id="joinRankingBtn" class="primary-btn">
                    <i class="fas fa-flag-checkered"></i>
                    랭킹 참가하기
                </button>
            </div>
        </header>

        <section class="home-dashboard ranking-dashboard">
            <div class="home-metrics" id="rankingStats"></div>

            <div class="home-main-grid ranking-layout">
                <div class="ranking-primary">
                    <div class="card-heading">
                        <div>
                            <h2>리더보드</h2>
                            <p>검증된 실적을 기준으로 실시간 업데이트 됩니다.</p>
                        </div>
                        <div class="ranking-tabs" id="timeframeTabs"></div>
                    </div>

                    <div class="home-prediction-board ranking-highlight">
                        <div class="board-header">
                            <div>
                                <h3>하이라이트</h3>
                                <span>최근 성과 기준 Top 3</span>
                            </div>
                            <button id="compareStrategiesBtn" class="board-action">전략 비교</button>
                        </div>
                        <table class="board-table" id="leaderHighlights"></table>
                    </div>

                    <div class="predictions-table-card ranking-table-card">
                        <div class="card-toolbar">
                            <div class="filter-group">
                                <label for="rankingTierFilter">티어</label>
                                <select id="rankingTierFilter" class="filter-select">
                                    <option value="all">전체</option>
                                    <option value="챌린저">챌린저</option>
                                    <option value="타이탄">타이탄</option>
                                    <option value="프로">프로</option>
                                    <option value="루키">루키</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="rankingSort">정렬</label>
                                <select id="rankingSort" class="filter-select">
                                    <option value="return">수익률</option>
                                    <option value="winrate">승률</option>
                                    <option value="streak">연속 성공</option>
                                    <option value="profit">총 수익</option>
                                </select>
                            </div>
                        </div>
                        <div class="predictions-table-wrapper">
                            <table class="predictions-table rankings-table">
                                <thead>
                                    <tr>
                                        <th>순위</th>
                                        <th>사용자</th>
                                        <th>수익률</th>
                                        <th>거래 수</th>
                                        <th>승률</th>
                                        <th>총 수익</th>
                                        <th>연속 성공</th>
                                        <th>동작</th>
                                    </tr>
                                </thead>
                                <tbody id="rankingTableBody"></tbody>
                            </table>
                            <div id="rankingEmpty" class="predictions-empty hidden">
                                <div class="empty-icon"><i class="fas fa-user-slash"></i></div>
                                <h3>조건에 맞는 랭커가 없습니다</h3>
                                <p>필터를 리셋하거나 다른 기간을 선택해보세요.</p>
                                <button id="resetFiltersBtn" class="ghost-btn">
                                    <i class="fas fa-arrow-rotate-left"></i>
                                    필터 초기화
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="home-news-card ranking-insights">
                        <div class="board-header">
                            <div>
                                <h3>전략 인사이트</h3>
                                <span>선택된 기간 기준 전략 요약</span>
                            </div>
                            <button id="refreshInsightsBtn" class="board-action">새로고침</button>
                        </div>
                        <ul class="news-list" id="insightsList"></ul>
                    </div>
                </div>

                <aside class="ranking-sidebar">
                    <div class="sidebar-card">
                        <div class="card-heading">
                            <div>
                                <h3>내 현재 성과</h3>
                                <p>오늘 오전 9시 기준</p>
                            </div>
                            <button id="viewDashboardBtn" class="ghost-btn small">대시보드</button>
                        </div>
                        <div id="profileStats" class="my-events"></div>
                    </div>

                    <div class="sidebar-card">
                        <div class="card-heading">
                            <div>
                                <h3>다가오는 대회</h3>
                                <p>추천 참가 일정</p>
                            </div>
                            <button id="openEventsBtn" class="ghost-btn small">전체 보기</button>
                        </div>
                        <div id="upcomingTournaments" class="my-events"></div>
                    </div>

                    <div class="sidebar-card">
                        <div class="card-heading">
                            <div>
                                <h3>전략 제안</h3>
                                <p>실시간 변동성에 기반한 Tip</p>
                            </div>
                        </div>
                        <ul id="strategySuggestions" class="news-list"></ul>
                    </div>
                </aside>
            </div>
        </section>
    </div>

    <!-- Secondary insights (desktop) -->
    <section class="charts-secondary-section desktop-only">
        <div class="charts-secondary-grid">
            <div class="chart-mini-card">
                <div class="mini-card-header"><span>BTC / USD</span><strong>$43,234</strong></div>
                <div class="mini-chart-canvas" id="rankMiniChartBTC"></div>
            </div>
            <div class="chart-mini-card">
                <div class="mini-card-header"><span>ETH / USD</span><strong>$2,687</strong></div>
                <div class="mini-chart-canvas" id="rankMiniChartETH"></div>
            </div>
            <div class="chart-mini-card">
                <div class="mini-card-header"><span>AAPL</span><strong>$178.24</strong></div>
                <div class="mini-chart-canvas" id="rankMiniChartAAPL"></div>
            </div>
            <div class="chart-mini-card">
                <div class="mini-card-header"><span>TSLA</span><strong>$251.89</strong></div>
                <div class="mini-chart-canvas" id="rankMiniChartTSLA"></div>
            </div>
            <div class="movers-card">
                <div class="card-heading">
                    <div>
                        <h3>전략 Top Movers</h3>
                        <p>변동이 큰 전략/종목 요약</p>
                    </div>
                </div>
                <div class="movers-list">
                    <div class="mover-row positive"><div class="mover-symbol"><i class="fab fa-bitcoin"></i><span>BTC</span></div><div class="mover-values"><span class="price">$43,480</span><span class="change">+3.12%</span></div></div>
                    <div class="mover-row positive"><div class="mover-symbol"><i class="fab fa-ethereum"></i><span>ETH</span></div><div class="mover-values"><span class="price">$2,704</span><span class="change">+2.18%</span></div></div>
                    <div class="mover-row negative"><div class="mover-symbol"><i class="fas fa-apple-alt"></i><span>AAPL</span></div><div class="mover-values"><span class="price">$176.90</span><span class="change">-0.76%</span></div></div>
                    <div class="mover-row positive"><div class="mover-symbol"><i class="fas fa-microchip"></i><span>NVDA</span></div><div class="mover-values"><span class="price">$421.67</span><span class="change">+1.34%</span></div></div>
                </div>
            </div>
        </div>
    </section>

    <section class="ranking-mobile mobile-only">
        <div class="mobile-hero-card mobile-fade-in">
            <div class="mobile-hero-top">
                <div>
                    <span class="mobile-hero-subtitle" id="mobileFilterLabel">랭킹 보드</span>
                    <span class="mobile-hero-title" id="mobileLeaderName">랭커를 불러오는 중</span>
                </div>
                <button class="mobile-notification-btn" id="mobileJoinRankingBtn" aria-label="랭킹 참가">
                    <i class="fas fa-flag-checkered"></i>
                </button>
            </div>
            <div class="mobile-hero-balance">
                <span class="label">수익률</span>
                <span class="value" id="mobileLeaderReturn">+0.0%</span>
            </div>
            <div class="mobile-hero-card-info">
                <div>
                    <span class="mobile-card-label">승률</span>
                    <span class="mobile-card-value" id="mobileLeaderWinRate">0%</span>
                </div>
                <div class="mobile-card-change" id="mobileLeaderTier">티어 정보 없음</div>
            </div>
            <div class="mobile-hero-card-meta">
                <span id="mobileLeaderStreak">연속 0승</span>
                <span class="mobile-card-chip"></span>
            </div>
        </div>

        <div class="mobile-filter-grid mobile-fade-in" id="mobileFilterChips"></div>

        <div class="mobile-stats-grid mobile-fade-in">
            <div class="mobile-stat-card">
                <div class="mobile-stat-label">참가자 수</div>
                <div class="mobile-stat-value" id="mobileStatParticipants">0</div>
                <div class="mobile-stat-change">실시간 업데이트</div>
            </div>
            <div class="mobile-stat-card">
                <div class="mobile-stat-label">최고 수익률</div>
                <div class="mobile-stat-value" id="mobileStatTopReturn">+0.0%</div>
                <div class="mobile-stat-change positive" id="mobileStatTopUser">-</div>
            </div>
            <div class="mobile-stat-card">
                <div class="mobile-stat-label">평균 수익률</div>
                <div class="mobile-stat-value" id="mobileStatAvgReturn">0.0%</div>
                <div class="mobile-stat-change" id="mobileStatWinRate">승률 0%</div>
            </div>
            <div class="mobile-stat-card">
                <div class="mobile-stat-label">최고 연속 성공</div>
                <div class="mobile-stat-value" id="mobileStatBestStreak">0</div>
                <div class="mobile-stat-change">연승 기록</div>
            </div>
        </div>

        <div class="mobile-card mobile-fade-in">
            <div class="mobile-card-header">
                <div>
                    <h3 class="mobile-card-title">Top 랭커</h3>
                    <span class="mobile-card-subtitle" id="mobileLeaderboardSubtitle">상위 5명 실시간</span>
                </div>
            </div>
            <div class="mobile-history-list" id="mobileLeaderboardList"></div>
        </div>

        <div class="mobile-card mobile-fade-in">
            <div class="mobile-card-header">
                <div>
                    <h3 class="mobile-card-title">전략 인사이트</h3>
                    <span class="mobile-card-subtitle" id="mobileInsightsSubtitle">기간별 요약</span>
                </div>
                <button class="mobile-card-action" id="mobileRefreshInsightsBtn">새로고침</button>
            </div>
            <ul class="mobile-news-list" id="mobileInsightsList"></ul>
        </div>

        <div class="mobile-card mobile-fade-in">
            <div class="mobile-card-header">
                <div>
                    <h3 class="mobile-card-title">다가오는 대회</h3>
                    <span class="mobile-card-subtitle">참가 추천 일정</span>
                </div>
                <button class="mobile-card-action" id="mobileOpenEventsBtn">전체 보기</button>
            </div>
            <div class="mobile-history-list" id="mobileTournamentsList"></div>
        </div>
    </section>

    <nav class="mobile-bottom-nav mobile-only" aria-label="모바일 하단 탐색">
        <a href="/" class="mobile-nav-item" title="홈">
            <i class="fas fa-home" aria-hidden="true"></i>
            <span>홈</span>
        </a>
        <a href="charts.html" class="mobile-nav-item" title="차트">
            <i class="fas fa-chart-area" aria-hidden="true"></i>
            <span>차트</span>
        </a>
        <a href="prediction.html" class="mobile-nav-item" title="예측">
            <i class="fas fa-magic" aria-hidden="true"></i>
            <span>예측</span>
        </a>
        <a href="ranking.html" class="mobile-nav-item active" title="랭킹" aria-current="page">
            <i class="fas fa-trophy" aria-hidden="true"></i>
            <span>랭킹</span>
        </a>
        <a href="events.html" class="mobile-nav-item" title="이벤트">
            <i class="fas fa-calendar-star" aria-hidden="true"></i>
            <span>이벤트</span>
        </a>
    </nav>

    <script>
        (function initRankMiniCharts(){
            if (typeof LightweightCharts === 'undefined') return;
            const ids = ['rankMiniChartBTC','rankMiniChartETH','rankMiniChartAAPL','rankMiniChartTSLA'];
            const bases = [43000, 2680, 178, 252];
            const colors = ['#00FFA3','#5BD5FF','#8CE99A','#FFD166'];
            const charts=[];
            function gen(base){
                const now = Math.floor(Date.now()/1000);
                return Array.from({length:40},(_,i)=>({time:now-(40-i)*3600,value:base+Math.sin(i/3)*base*0.005+(Math.random()-0.5)*base*0.002}));
            }
            ids.forEach((id,idx)=>{
                const el=document.getElementById(id); if(!el) return;
                const chart=LightweightCharts.createChart(el,{width:el.clientWidth,height:140,layout:{background:{type:'solid',color:'transparent'},textColor:'#cfe6ff'},grid:{vertLines:{color:'rgba(255,255,255,0.06)'},horzLines:{color:'rgba(255,255,255,0.06)'}},rightPriceScale:{visible:false},timeScale:{borderColor:'rgba(255,255,255,0.06)'}});
                const series=chart.addAreaSeries({lineColor:colors[idx],topColor:colors[idx]+'44',bottomColor:colors[idx]+'11'});
                series.setData(gen(bases[idx]));
                chart.timeScale().fitContent();
                charts.push({chart,el});
            });
            window.addEventListener('resize',()=>charts.forEach(({chart,el})=>chart.applyOptions({width:el.clientWidth})));
        })();
    </script>

    <div id="rankingToast" class="home-toast"></div>

    <script>
        const rankingState = {
            currentFilter: 'daily',
            tierFilter: 'all',
            searchTerm: '',
            sortKey: 'return',
            filters: [
                { id: 'daily', label: '일간', description: '24시간 실적' },
                { id: 'weekly', label: '주간', description: '최근 7일' },
                { id: 'monthly', label: '월간', description: '최근 30일' },
                { id: 'yearly', label: '연간', description: '최근 365일' }
            ],
            entries: [
                { id: 'd-1', username: '투자왕123', avatar: '투', tier: '챌린저', timeframe: 'daily', returnRate: 24.7, trades: 127, winRate: 87.4, profit: 4250000, streak: 8 },
                { id: 'd-2', username: '주식마스터', avatar: '주', tier: '타이탄', timeframe: 'daily', returnRate: 19.3, trades: 95, winRate: 82.1, profit: 3180000, streak: 6 },
                { id: 'd-3', username: '전략예측러', avatar: '전', tier: '프로', timeframe: 'daily', returnRate: 15.8, trades: 78, winRate: 79.5, profit: 2650000, streak: 5 },
                { id: 'd-4', username: '차트분석가', avatar: '차', tier: '프로', timeframe: 'daily', returnRate: 12.1, trades: 65, winRate: 75.4, profit: 1980000, streak: 4 },
                { id: 'd-5', username: '데이트레이더', avatar: '데', tier: '프로', timeframe: 'daily', returnRate: 9.4, trades: 156, winRate: 71.2, profit: 1540000, streak: 3 },
                { id: 'w-1', username: '스윙킹', avatar: '스', tier: '챌린저', timeframe: 'weekly', returnRate: 32.5, trades: 42, winRate: 68.2, profit: 3120000, streak: 5 },
                { id: 'w-2', username: '포지션헌터', avatar: '포', tier: '타이탄', timeframe: 'weekly', returnRate: 27.1, trades: 53, winRate: 73.4, profit: 2860000, streak: 4 },
                { id: 'm-1', username: '퀀트마스터', avatar: '퀀', tier: '챌린저', timeframe: 'monthly', returnRate: 58.9, trades: 118, winRate: 69.5, profit: 8450000, streak: 9 },
                { id: 'm-2', username: '리스크제로', avatar: '리', tier: '타이탄', timeframe: 'monthly', returnRate: 41.2, trades: 102, winRate: 75.2, profit: 6230000, streak: 7 },
                { id: 'y-1', username: '롱런전략가', avatar: '롱', tier: '챌린저', timeframe: 'yearly', returnRate: 128.4, trades: 520, winRate: 64.1, profit: 18500000, streak: 12 },
                { id: 'y-2', username: '하이브리드전략', avatar: '하', tier: '프로', timeframe: 'yearly', returnRate: 112.8, trades: 447, winRate: 66.9, profit: 16200000, streak: 10 },
                { id: 'w-3', username: '국내주식러', avatar: '국', tier: '루키', timeframe: 'weekly', returnRate: 18.6, trades: 24, winRate: 62.3, profit: 930000, streak: 2 }
            ],
            insights: {
                daily: [
                    '일간 챌린저 티어 평균 수익률은 +18.6%로 전일 대비 2.1% 상승했습니다.',
                    '자동화 전략 채택 비율이 63%를 돌파하며 상승장 대응력이 향상되었습니다.',
                    '가장 긴 연속 성공은 8회로, 변동성 장세에서 짧은 홀딩 전략이 효과적이었습니다.'
                ],
                weekly: [
                    '주간 상위권은 평균 32% 이상의 수익률을 기록하며 변동성 플레이에 강점을 보였습니다.',
                    '스윙 전략과 보조 시그널을 결합한 유저의 승률이 70%를 넘었습니다.',
                    '손실 제한을 4% 이내로 설정한 참가자가 평균보다 1.6배 높은 승률을 기록했습니다.'
                ],
                monthly: [
                    '월간 Top3의 평균 연속 성공 수는 8.7회로 장기 추세 추종 전략이 돋보입니다.',
                    '퀀트 기반 포트폴리오 조정 빈도가 낮을수록 누적 수익이 높게 나타났습니다.',
                    '자동 매매 시그널 신뢰도(45일 기준)가 92%로 업데이트되었습니다.'
                ],
                yearly: [
                    '연간 기준 누적 수익 1억원 이상 참가자가 12명으로 사상 최대치를 기록했습니다.',
                    '롱런전략가는 변동성 25% 구간에서도 12연승을 유지했습니다.',
                    '리스크 조정 수익률(Sharpe) 2.1 이상 전략 비중이 34%까지 확대되었습니다.'
                ]
            },
            myProfile: {
                rank: 47,
                returnRate: 5.2,
                winRate: 65.2,
                streak: 3,
                bestTimeframe: '주간',
                target: 'Top 20 진입',
                strategy: '상승 전략 유지'
            },
            upcoming: [
                { title: '주간 예측 스프린트', date: '10월 12일', reward: '₩500,000', status: '접수 중' },
                { title: '하이브리드 전략 챌린지', date: '10월 25일', reward: '프리미엄 2개월', status: '대기 중' },
                { title: '연말 결산 빅배틀', date: '11월 02일', reward: '총 상금 ₩10,000,000', status: '사전 예약' }
            ],
            strategies: [
                { title: '전략 추세 추종', meta: '정확도 92% · 추천', tone: 'positive' },
                { title: '변동성 박스 매매', meta: '장 초반 스캘핑 강화', tone: 'neutral' },
                { title: '리스크 헤지 플랜', meta: '포트폴리오 방어 추천', tone: 'info' }
            ]
        };

        document.addEventListener('DOMContentLoaded', () => {
            renderFilters();
            renderMobileFilters();
            renderStats();
            renderLeaderboard();
            renderTable();
            renderInsights();
            renderProfile();
            renderUpcoming();
            renderStrategies();
            renderMobileRanking();
            attachRankingHandlers();
        });

        function renderFilters() {
            const container = document.getElementById('timeframeTabs');
            container.innerHTML = rankingState.filters.map(filter => `
                <button class="ghost-btn small ${filter.id === rankingState.currentFilter ? 'active' : ''}" data-filter="${filter.id}">
                    ${filter.label}
                </button>
            `).join('');
        }

        function renderMobileFilters() {
            const chips = document.getElementById('mobileFilterChips');
            if (!chips) return;

            chips.innerHTML = rankingState.filters.map(filter => `
                <button type="button" class="mobile-filter-chip ${filter.id === rankingState.currentFilter ? 'active' : ''}" data-mobile-filter="${filter.id}">
                    ${filter.label}
                </button>
            `).join('');
        }

        function renderStats() {
            const statsContainer = document.getElementById('rankingStats');
            const entries = getFilteredEntries();

            if (entries.length === 0) {
                statsContainer.innerHTML = `
                    <div class="metric-card primary">
                        <div class="metric-label">참가자 수</div>
                        <div class="metric-value">0</div>
                        <div class="metric-change info">데이터 없음</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">평균 수익률</div>
                        <div class="metric-value">0%</div>
                        <div class="metric-sub">새로운 참가자를 기다리는 중</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">최고 연속 성공</div>
                        <div class="metric-value">0</div>
                        <div class="metric-sub">성과 데이터 없음</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">분석 신뢰도</div>
                        <div class="metric-value">92%</div>
                        <div class="metric-sub">기본 모델 기준</div>
                    </div>
                `;
                return;
            }

            const totalParticipants = entries.length;
            const topReturn = entries[0].returnRate;
            const avgReturn = entries.reduce((sum, item) => sum + item.returnRate, 0) / entries.length;
            const avgWinRate = entries.reduce((sum, item) => sum + item.winRate, 0) / entries.length;
            const bestStreak = Math.max(...entries.map(item => item.streak));

            statsContainer.innerHTML = `
                <div class="metric-card primary">
                    <div class="metric-label">참가자 수</div>
                    <div class="metric-value">${totalParticipants}</div>
                    <div class="metric-change positive">실시간 동기화</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">최고 수익률</div>
                    <div class="metric-value positive-text">+${topReturn.toFixed(1)}%</div>
                    <div class="metric-sub">${getFilterLabel()} 기준</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">평균 수익률</div>
                    <div class="metric-value">${avgReturn.toFixed(1)}%</div>
                    <div class="metric-sub">승률 ${avgWinRate.toFixed(1)}%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">연속 성공</div>
                    <div class="metric-value">${bestStreak}</div>
                    <div class="metric-sub">최고 연승 기록</div>
                </div>
            `;
        }

        function renderLeaderboard() {
            const highlights = document.getElementById('leaderHighlights');
            const entries = getFilteredEntries().slice(0, 3);

            if (!entries.length) {
                highlights.innerHTML = `
                    <tbody>
                        <tr>
                            <td colspan="4">표시할 리더가 없습니다.</td>
                        </tr>
                    </tbody>
                `;
                return;
            }

            highlights.innerHTML = `
                <thead>
                    <tr>
                        <th>순위</th>
                        <th>사용자</th>
                        <th>수익률</th>
                        <th>연속 성공</th>
                    </tr>
                </thead>
                <tbody>
                    ${entries.map((item, index) => `
                        <tr>
                            <td><span class="rank ${index === 0 ? 'gold' : index === 1 ? 'silver' : 'bronze'}">${index + 1}</span></td>
                            <td>
                                <div class="board-user">
                                    <span class="avatar">${item.avatar}</span>
                                    <div>
                                        <span class="board-name">${item.username}</span>
                                        <span class="board-meta">${item.tier}</span>
                                    </div>
                                </div>
                            </td>
                            <td class="positive">+${item.returnRate.toFixed(1)}%</td>
                            <td>${item.streak}회</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
        }

        function renderTable() {
            const tableBody = document.getElementById('rankingTableBody');
            const emptyState = document.getElementById('rankingEmpty');
            const entries = getFilteredEntries(true);

            if (!entries.length) {
                tableBody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            tableBody.innerHTML = entries.map((item, index) => `
                <tr>
                    <td><span class="symbol-tag">${index + 1}</span></td>
                    <td>
                        <div class="table-symbol">
                            <span class="symbol-tag">${item.avatar}</span>
                            <div class="table-col">
                                <strong>${item.username}</strong>
                                <span class="subtext">${item.tier}</span>
                            </div>
                        </div>
                    </td>
                    <td class="numeric positive-text">+${item.returnRate.toFixed(1)}%</td>
                    <td class="numeric">${item.trades}</td>
                    <td class="numeric">${item.winRate.toFixed(1)}%</td>
                    <td class="numeric positive-text">${formatCurrency(item.profit)}</td>
                    <td class="numeric">${item.streak}회</td>
                    <td>
                        <div class="table-actions">
                            <button class="ghost-btn small" data-action="inspect" data-id="${item.id}">분석</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderInsights() {
            const list = document.getElementById('insightsList');
            const insights = rankingState.insights[rankingState.currentFilter] || [];
            list.innerHTML = insights.map(text => `
                <li>
                    <span class="news-title">${text}</span>
                    <span class="news-meta">전략 분석</span>
                </li>
            `).join('');
        }

        function renderProfile() {
            const container = document.getElementById('profileStats');
            const profile = rankingState.myProfile;
            container.innerHTML = `
                <div class="my-event-item primary">
                    <div>
                        <h4>현재 순위</h4>
                        <span>${profile.rank}위</span>
                    </div>
                    <div class="my-event-stats">
                        <span class="rank">${profile.strategy}</span>
                        <span class="return positive">목표 ${profile.target}</span>
                    </div>
                </div>
                <div class="my-event-item">
                    <div>
                        <h4>일간 수익률</h4>
                        <span>승률 ${profile.winRate.toFixed(1)}%</span>
                    </div>
                    <div class="my-event-stats">
                        <span class="return positive">+${profile.returnRate.toFixed(1)}%</span>
                        <span class="rank">연속 ${profile.streak}회</span>
                    </div>
                </div>
                <div class="my-event-item">
                    <div>
                        <h4>강점 구간</h4>
                        <span>${profile.bestTimeframe} 성과 우수</span>
                    </div>
                    <div class="my-event-stats">
                        <button class="ghost-btn tiny" id="improvePlanBtn">향상 플랜</button>
                    </div>
                </div>
            `;
        }

        function renderUpcoming() {
            const container = document.getElementById('upcomingTournaments');
            container.innerHTML = rankingState.upcoming.map(item => `
                <div class="my-event-item">
                    <div>
                        <h4>${item.title}</h4>
                        <span>${item.date} · ${item.status}</span>
                    </div>
                    <div class="my-event-stats">
                        <span class="return positive">${item.reward}</span>
                        <button class="ghost-btn tiny" data-action="join-event" data-title="${item.title}">참가</button>
                    </div>
                </div>
            `).join('');
        }

        function renderStrategies() {
            const list = document.getElementById('strategySuggestions');
            list.innerHTML = rankingState.strategies.map(item => `
                <li class="news-item ${item.tone}">
                    <div>
                        <span class="news-title">${item.title}</span>
                        <span class="news-meta">${item.meta}</span>
                    </div>
                    <button class="ghost-btn tiny" data-action="strategy">상세</button>
                </li>
            `).join('');
        }

        function renderMobileRanking() {
            const heroName = document.getElementById('mobileLeaderName');
            if (!heroName) return;

            const entries = getFilteredEntries(true);
            const filterLabel = getFilterLabel();

            const filterLabelEl = document.getElementById('mobileFilterLabel');
            if (filterLabelEl) {
                filterLabelEl.textContent = filterLabel ? `${filterLabel} 리더보드` : '랭킹 보드';
            }

            const heroReturnEl = document.getElementById('mobileLeaderReturn');
            const heroWinRateEl = document.getElementById('mobileLeaderWinRate');
            const heroTierEl = document.getElementById('mobileLeaderTier');
            const heroStreakEl = document.getElementById('mobileLeaderStreak');

            if (!entries.length) {
                heroName.textContent = '표시할 랭커가 없습니다';
                if (heroReturnEl) heroReturnEl.textContent = '+0.0%';
                if (heroWinRateEl) heroWinRateEl.textContent = '0%';
                if (heroTierEl) {
                    heroTierEl.className = 'mobile-card-change';
                    heroTierEl.textContent = '티어 정보 없음';
                }
                if (heroStreakEl) heroStreakEl.textContent = '연속 0승';

                updateMobileStats(entries);
                updateMobileLeaderboard(entries);
                updateMobileInsights();
                updateMobileTournaments();
                return;
            }

            const leader = entries[0];
            const formattedReturn = `${leader.returnRate >= 0 ? '+' : ''}${leader.returnRate.toFixed(1)}%`;
            const formattedWinRate = `${leader.winRate.toFixed(1)}%`;

            heroName.textContent = leader.username;
            if (heroReturnEl) heroReturnEl.textContent = formattedReturn;
            if (heroWinRateEl) heroWinRateEl.textContent = formattedWinRate;
            if (heroTierEl) {
                const emphasized = leader.tier === '챌린저' || leader.tier === '타이탄';
                heroTierEl.className = `mobile-card-change ${emphasized ? 'positive' : ''}`.trim();
                heroTierEl.textContent = leader.tier;
            }
            if (heroStreakEl) heroStreakEl.textContent = `연속 ${leader.streak}승`;

            updateMobileStats(entries);
            updateMobileLeaderboard(entries);
            updateMobileInsights();
            updateMobileTournaments();
        }

        function updateMobileStats(entries) {
            const participantsEl = document.getElementById('mobileStatParticipants');
            const topReturnEl = document.getElementById('mobileStatTopReturn');
            const topUserEl = document.getElementById('mobileStatTopUser');
            const avgReturnEl = document.getElementById('mobileStatAvgReturn');
            const winRateEl = document.getElementById('mobileStatWinRate');
            const bestStreakEl = document.getElementById('mobileStatBestStreak');

            if (!participantsEl) return;

            if (!entries.length) {
                participantsEl.textContent = '0';
                if (topReturnEl) topReturnEl.textContent = '+0.0%';
                if (topUserEl) topUserEl.textContent = '-';
                if (avgReturnEl) avgReturnEl.textContent = '0.0%';
                if (winRateEl) winRateEl.textContent = '승률 0%';
                if (bestStreakEl) bestStreakEl.textContent = '0';
                return;
            }

            const participants = entries.length;
            const topEntry = entries[0];
            const avgReturn = entries.reduce((sum, item) => sum + item.returnRate, 0) / entries.length;
            const avgWinRate = entries.reduce((sum, item) => sum + item.winRate, 0) / entries.length;
            const bestStreak = Math.max(...entries.map(item => item.streak));

            participantsEl.textContent = participants.toString();
            if (topReturnEl) topReturnEl.textContent = `${topEntry.returnRate >= 0 ? '+' : ''}${topEntry.returnRate.toFixed(1)}%`;
            if (topUserEl) topUserEl.textContent = topEntry.username;
            if (avgReturnEl) avgReturnEl.textContent = `${avgReturn.toFixed(1)}%`;
            if (winRateEl) winRateEl.textContent = `승률 ${avgWinRate.toFixed(1)}%`;
            if (bestStreakEl) bestStreakEl.textContent = bestStreak.toString();
        }

        function updateMobileLeaderboard(entries) {
            const list = document.getElementById('mobileLeaderboardList');
            if (!list) return;

            if (!entries.length) {
                list.innerHTML = `
                    <div class="mobile-transaction-item">
                        <div class="mobile-list-icon"><i class="fas fa-user-slash"></i></div>
                        <div class="mobile-list-content">
                            <div class="mobile-list-title">랭킹 데이터를 찾을 수 없습니다.</div>
                            <div class="mobile-transaction-meta">필터를 조정하거나 기간을 변경해보세요.</div>
                        </div>
                    </div>
                `;
                return;
            }

            list.innerHTML = entries.slice(0, 5).map((item, index) => `
                <div class="mobile-transaction-item">
                    <div class="mobile-list-icon">${index + 1}</div>
                    <div class="mobile-list-content">
                        <div class="mobile-list-title">${item.username}</div>
                        <div class="mobile-transaction-meta">${item.tier} · 승률 ${item.winRate.toFixed(1)}% · ${item.trades}회</div>
                    </div>
                    <div class="mobile-list-value ${item.returnRate >= 0 ? 'positive' : 'negative'}">${item.returnRate >= 0 ? '+' : ''}${item.returnRate.toFixed(1)}%</div>
                </div>
            `).join('');

            const subtitle = document.getElementById('mobileLeaderboardSubtitle');
            if (subtitle) {
                const label = getFilterLabel();
                const count = Math.min(entries.length, 5);
                subtitle.textContent = label ? `상위 ${count}명 · ${label} 기준` : `상위 ${count}명`;
            }
        }

        function updateMobileInsights() {
            const insightsList = document.getElementById('mobileInsightsList');
            if (!insightsList) return;

            const insights = rankingState.insights[rankingState.currentFilter] || [];
            if (!insights.length) {
                insightsList.innerHTML = `
                    <li>
                        <span class="news-title">표시할 인사이트가 없습니다.</span>
                        <span class="news-time">데이터 대기 중</span>
                    </li>
                `;
                return;
            }

            insightsList.innerHTML = insights.map((text, index) => `
                <li>
                    <span class="news-title">${text}</span>
                    <span class="news-time">인사이트 ${index + 1}</span>
                </li>
            `).join('');

            const subtitle = document.getElementById('mobileInsightsSubtitle');
            if (subtitle) {
                const label = getFilterLabel();
                subtitle.textContent = label ? `${label} 기준 전략 요약` : '전략 요약';
            }
        }

        function updateMobileTournaments() {
            const list = document.getElementById('mobileTournamentsList');
            if (!list) return;

            if (!rankingState.upcoming.length) {
                list.innerHTML = `
                    <div class="mobile-transaction-item">
                        <div class="mobile-list-icon"><i class="fas fa-calendar-times"></i></div>
                        <div class="mobile-list-content">
                            <div class="mobile-list-title">예정된 대회가 없습니다.</div>
                            <div class="mobile-transaction-meta">새로운 이벤트가 등록되면 알려드릴게요.</div>
                        </div>
                    </div>
                `;
                return;
            }

            list.innerHTML = rankingState.upcoming.map(item => `
                <div class="mobile-transaction-item">
                    <div class="mobile-list-icon"><i class="fas fa-trophy"></i></div>
                    <div class="mobile-list-content">
                        <div class="mobile-list-title">${item.title}</div>
                        <div class="mobile-transaction-meta">${item.date} · ${item.status}</div>
                    </div>
                    <div class="mobile-list-value positive">${item.reward}</div>
                </div>
            `).join('');
        }

        function attachRankingHandlers() {
            document.getElementById('timeframeTabs').addEventListener('click', event => {
                const button = event.target.closest('button[data-filter]');
                if (!button) return;
                rankingState.currentFilter = button.dataset.filter;
                renderFilters();
                renderMobileFilters();
                refreshRankingView();
                showRankingToast(`${button.textContent.trim()} 리더보드로 전환했습니다.`, 'info');
            });

            const mobileFilterChips = document.getElementById('mobileFilterChips');
            if (mobileFilterChips) {
                mobileFilterChips.addEventListener('click', event => {
                    const chip = event.target.closest('[data-mobile-filter]');
                    if (!chip) return;
                    rankingState.currentFilter = chip.dataset.mobileFilter;
                    renderFilters();
                    renderMobileFilters();
                    refreshRankingView();
                    showRankingToast(`${chip.textContent.trim()} 리더보드로 전환했습니다.`, 'info');
                });
            }

            document.getElementById('rankingTierFilter').addEventListener('change', event => {
                rankingState.tierFilter = event.target.value;
                renderTable();
                renderLeaderboard();
                renderStats();
                renderMobileRanking();
            });

            document.getElementById('rankingSort').addEventListener('change', event => {
                rankingState.sortKey = event.target.value;
                renderTable();
                renderMobileRanking();
            });

            document.getElementById('rankingSearch').addEventListener('keydown', event => {
                if (event.key === 'Enter') {
                    rankingState.searchTerm = event.target.value.trim();
                    renderTable();
                    renderLeaderboard();
                    renderStats();
                    renderMobileRanking();
                    event.target.value = '';
                }
            });

            document.getElementById('rankingTableBody').addEventListener('click', event => {
                const action = event.target.closest('[data-action]');
                if (!action) return;

                if (action.dataset.action === 'inspect') {
                    const entry = rankingState.entries.find(item => item.id === action.dataset.id);
                    if (entry) {
                        showRankingToast(`${entry.username}님의 전략 리포트를 준비 중입니다.`, 'info');
                    }
                }
            });

            document.getElementById('resetFiltersBtn').addEventListener('click', () => {
                rankingState.tierFilter = 'all';
                rankingState.searchTerm = '';
                document.getElementById('rankingTierFilter').value = 'all';
                renderTable();
                renderLeaderboard();
                renderStats();
                renderMobileRanking();
                showRankingToast('필터와 검색 조건이 초기화되었습니다.', 'success');
            });

            document.getElementById('downloadRankingBtn').addEventListener('click', () => {
                showRankingToast('랭킹 데이터를 CSV로 내보냈습니다.', 'success');
            });

            document.getElementById('joinRankingBtn').addEventListener('click', () => {
                showRankingToast('랭킹 참가 신청이 완료되었습니다. 화이팅!', 'success');
            });

            const mobileJoinBtn = document.getElementById('mobileJoinRankingBtn');
            if (mobileJoinBtn) {
                mobileJoinBtn.addEventListener('click', () => {
                    showRankingToast('모바일에서 랭킹 참가 신청을 완료했습니다!', 'success');
                });
            }

            const mobileRefreshBtn = document.getElementById('mobileRefreshInsightsBtn');
            if (mobileRefreshBtn) {
                mobileRefreshBtn.addEventListener('click', () => {
                    showRankingToast('전략 인사이트를 새로고침했습니다.', 'success');
                    updateMobileInsights();
                });
            }

            const mobileEventsBtn = document.getElementById('mobileOpenEventsBtn');
            if (mobileEventsBtn) {
                mobileEventsBtn.addEventListener('click', () => {
                    window.location.href = 'events.html';
                });
            }

            document.getElementById('refreshInsightsBtn').addEventListener('click', () => {
                showRankingToast('전략 인사이트가 최신 상태로 업데이트되었습니다.', 'success');
                updateMobileInsights();
            });

            document.getElementById('compareStrategiesBtn').addEventListener('click', () => {
                showRankingToast('전략 비교 모듈은 곧 제공될 예정입니다.', 'info');
            });

            document.getElementById('profileStats').addEventListener('click', event => {
                if (event.target && event.target.id === 'improvePlanBtn') {
                    showRankingToast('향상 플랜이 곧 공개됩니다.', 'info');
                }
            });

            document.getElementById('upcomingTournaments').addEventListener('click', event => {
                const target = event.target.closest('[data-action="join-event"]');
                if (!target) return;
                showRankingToast(`${target.dataset.title} 참가 등록이 완료되었습니다.`, 'success');
            });

            document.getElementById('strategySuggestions').addEventListener('click', event => {
                const target = event.target.closest('[data-action="strategy"]');
                if (!target) return;
                showRankingToast('전략 세부 설명은 프리미엄에서 확인하실 수 있습니다.', 'info');
            });

            document.getElementById('viewDashboardBtn').addEventListener('click', () => {
                showRankingToast('개인 대시보드로 이동합니다.', 'info');
            });

            document.getElementById('openEventsBtn').addEventListener('click', () => {
                window.location.href = 'events.html';
            });
        }

        function refreshRankingView() {
            renderMobileFilters();
            renderStats();
            renderLeaderboard();
            renderTable();
            renderInsights();
            renderMobileRanking();
        }

        function getFilteredEntries(includeSort = false) {
            const base = rankingState.entries.filter(entry => entry.timeframe === rankingState.currentFilter);
            const tierFiltered = rankingState.tierFilter === 'all'
                ? base
                : base.filter(entry => entry.tier === rankingState.tierFilter);

            const searchFiltered = rankingState.searchTerm
                ? tierFiltered.filter(entry => entry.username.toLowerCase().includes(rankingState.searchTerm.toLowerCase()))
                : tierFiltered;

            const sorted = [...searchFiltered].sort((a, b) => {
                switch (rankingState.sortKey) {
                    case 'winrate':
                        return b.winRate - a.winRate;
                    case 'streak':
                        return b.streak - a.streak;
                    case 'profit':
                        return b.profit - a.profit;
                    default:
                        return b.returnRate - a.returnRate;
                }
            });

            return includeSort ? sorted : sorted;
        }

        function getFilterLabel() {
            const filter = rankingState.filters.find(item => item.id === rankingState.currentFilter);
            return filter ? filter.label : '';
        }

        function formatCurrency(value) {
            return '₩' + Math.round(value).toLocaleString('ko-KR');
        }

        function showRankingToast(message, type = 'success') {
            const toast = document.getElementById('rankingToast');
            toast.textContent = message;
            toast.className = `home-toast visible ${type}`;
            clearTimeout(showRankingToast.timer);
            showRankingToast.timer = setTimeout(() => {
                toast.classList.remove('visible');
            }, 3000);
        }
    </script>

    <script src="js/collapsible-sidebar.js"></script>
</body>
</html>