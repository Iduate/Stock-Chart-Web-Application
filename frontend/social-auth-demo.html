<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œì…œ ë¡œê·¸ì¸ - Stock Chart</title>
    <meta name="csrf-token" content="{{ csrf_token }}">

    <!-- CSS -->
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/social-auth.css">

    <style>
        .demo-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .demo-section {
            margin: 40px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            background: #ffffff;
        }

        .demo-title {
            font-size: 24px;
            font-weight: 700;
            color: #212529;
            margin-bottom: 10px;
        }

        .demo-subtitle {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin: 20px 0 10px 0;
        }

        .demo-description {
            color: #6c757d;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .status-display {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .demo-btn {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .demo-btn:hover {
            background: #0056b3;
        }

        .demo-btn.secondary {
            background: #6c757d;
        }

        .demo-btn.secondary:hover {
            background: #545b62;
        }

        .user-info-display {
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
</head>

<body>
    <div class="demo-container">
        <div class="demo-section">
            <h1 class="demo-title">ğŸ” ì†Œì…œ ë¡œê·¸ì¸ ì‹œìŠ¤í…œ</h1>
            <p class="demo-description">
                Stock Chart ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì†Œì…œ ì¸ì¦ ì‹œìŠ¤í…œì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.
                Google, Facebook, Naver, Kakao, Apple ë“± ë‹¤ì–‘í•œ ì†Œì…œ ì œê³µì—…ì²´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
            </p>
        </div>

        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div class="demo-section">
            <h2 class="demo-subtitle">ğŸ“± ì†Œì…œ ë¡œê·¸ì¸</h2>
            <p class="demo-description">
                ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì†Œì…œ ë¡œê·¸ì¸ì„ ì‹œë„í•´ë³´ì„¸ìš”. íŒì—… ë°©ì‹ìœ¼ë¡œ ì¸ì¦ì´ ì§„í–‰ë©ë‹ˆë‹¤.
            </p>

            <div class="social-login-container">
                <div class="social-login-title">ì†Œì…œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</div>
                <div data-social-login-container></div>

                <div class="social-login-divider">
                    <span>ë˜ëŠ” ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ</span>
                </div>

                <div class="btn-group">
                    <button class="demo-btn" id="redirect-login-btn">ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì‹ ë¡œê·¸ì¸</button>
                    <button class="demo-btn secondary" id="clear-tokens-btn">í† í° ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div id="login-status" class="status-display">
                ë¡œê·¸ì¸ ìƒíƒœë¥¼ ì—¬ê¸°ì— í‘œì‹œí•©ë‹ˆë‹¤...
            </div>
        </div>

        <!-- ì‚¬ìš©ì ì •ë³´ ì„¹ì…˜ -->
        <div class="demo-section">
            <h2 class="demo-subtitle">ğŸ‘¤ ì‚¬ìš©ì ì •ë³´</h2>
            <p class="demo-description">
                ë¡œê·¸ì¸ í›„ ì‚¬ìš©ì ì •ë³´ì™€ ì—°ê²°ëœ ì†Œì…œ ê³„ì •ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>

            <div class="btn-group">
                <button class="demo-btn" id="load-user-info-btn">ì‚¬ìš©ì ì •ë³´ ë¡œë“œ</button>
                <button class="demo-btn" id="load-social-accounts-btn">ì†Œì…œ ê³„ì • ëª©ë¡</button>
                <button class="demo-btn secondary" id="social-logout-btn">ì†Œì…œ ë¡œê·¸ì•„ì›ƒ</button>
            </div>

            <div id="user-info-display" class="user-info-display" style="display: none;">
                <!-- ì‚¬ìš©ì ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <div id="user-status" class="status-display">
                ì‚¬ìš©ì ì •ë³´ë¥¼ ë¡œë“œí•˜ë ¤ë©´ ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”...
            </div>
        </div>

        <!-- ê³„ì • ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="demo-section">
            <h2 class="demo-subtitle">âš™ï¸ ì†Œì…œ ê³„ì • ê´€ë¦¬</h2>
            <p class="demo-description">
                ì—°ê²°ëœ ì†Œì…œ ê³„ì •ì„ ê´€ë¦¬í•˜ê³  ìƒˆë¡œìš´ ê³„ì •ì„ ì—°ê²°í•˜ê±°ë‚˜ ê¸°ì¡´ ê³„ì •ì„ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>

            <div id="social-account-manager">
                <!-- ì†Œì…œ ê³„ì • ê´€ë¦¬ UIê°€ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- API í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
        <div class="demo-section">
            <h2 class="demo-subtitle">ğŸ”§ API í…ŒìŠ¤íŠ¸</h2>
            <p class="demo-description">
                ì†Œì…œ ì¸ì¦ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì§ì ‘ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.
            </p>

            <div class="btn-group">
                <button class="demo-btn" id="test-providers-api">ì œê³µì—…ì²´ ëª©ë¡ API</button>
                <button class="demo-btn" id="test-refresh-token">í† í° ê°±ì‹  API</button>
                <button class="demo-btn" id="test-auth-stats">ì¸ì¦ í†µê³„ API</button>
            </div>

            <div id="api-test-result" class="status-display">
                API í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/social-auth.js"></script>
    <script>
        // ì†Œì…œ ì¸ì¦ ë§¤ë‹ˆì € ì´ˆê¸°í™”
        const socialAuth = new SocialAuthManager({
            baseUrl: '/api/users/auth',
            onSuccess: (result) => {
                updateStatus('login-status', `âœ… ë¡œê·¸ì¸ ì„±ê³µ!\n${JSON.stringify(result, null, 2)}`);

                // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                if (result.user) {
                    displayUserInfo(result.user);
                }

                // ì†Œì…œ ê³„ì • ê´€ë¦¬ UI ì—…ë°ì´íŠ¸
                loadSocialAccountManager();
            },
            onError: (error, provider) => {
                updateStatus('login-status', `âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨ (${provider}): ${error.message}`);
            },
            onStart: (provider) => {
                updateStatus('login-status', `ğŸ”„ ${provider} ë¡œê·¸ì¸ ì‹œì‘...`);
            }
        });

        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStatus(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            }
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function displayUserInfo(user) {
            const displayElement = document.getElementById('user-info-display');
            if (displayElement) {
                displayElement.style.display = 'block';
                displayElement.innerHTML = `
                    <h4>ğŸ¯ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì</h4>
                    <p><strong>ID:</strong> ${user.id}</p>
                    <p><strong>ì‚¬ìš©ìëª…:</strong> ${user.username}</p>
                    <p><strong>ì´ë©”ì¼:</strong> ${user.email}</p>
                    <p><strong>ì´ë¦„:</strong> ${user.first_name} ${user.last_name}</p>
                    <p><strong>ì‚¬ìš©ì íƒ€ì…:</strong> ${user.user_type}</p>
                    <p><strong>ì–¸ì–´ ì„¤ì •:</strong> ${user.language_preference}</p>
                `;
            }
        }

        // ì†Œì…œ ê³„ì • ê´€ë¦¬ UI ë¡œë“œ
        async function loadSocialAccountManager() {
            try {
                const accounts = await socialAuth.getUserSocialAccounts();
                createSocialAccountManager('social-account-manager', socialAuth);
                updateStatus('user-status', `ì†Œì…œ ê³„ì • ê´€ë¦¬ UI ë¡œë“œ ì™„ë£Œ (${accounts.length}ê°œ ê³„ì •)`);
            } catch (error) {
                updateStatus('user-status', `ì†Œì…œ ê³„ì • ê´€ë¦¬ UI ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', () => {
            // ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì‹ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
            document.getElementById('redirect-login-btn').addEventListener('click', () => {
                socialAuth.startSocialLogin('google', { redirect: true });
            });

            // í† í° ì´ˆê¸°í™”
            document.getElementById('clear-tokens-btn').addEventListener('click', () => {
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token');
                localStorage.removeItem('user_info');
                updateStatus('login-status', 'ğŸ—‘ï¸ í† í°ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('user-info-display').style.display = 'none';
            });

            // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
            document.getElementById('load-user-info-btn').addEventListener('click', () => {
                const userInfo = localStorage.getItem('user_info');
                if (userInfo) {
                    const user = JSON.parse(userInfo);
                    displayUserInfo(user);
                    updateStatus('user-status', 'âœ… ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ');
                } else {
                    updateStatus('user-status', 'âŒ ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            });

            // ì†Œì…œ ê³„ì • ëª©ë¡ ë¡œë“œ
            document.getElementById('load-social-accounts-btn').addEventListener('click', async () => {
                try {
                    const accounts = await socialAuth.getUserSocialAccounts();
                    updateStatus('user-status', `âœ… ì†Œì…œ ê³„ì • ëª©ë¡ ë¡œë“œ ì„±ê³µ:\n${JSON.stringify(accounts, null, 2)}`);
                } catch (error) {
                    updateStatus('user-status', `âŒ ì†Œì…œ ê³„ì • ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
                }
            });

            // ì†Œì…œ ë¡œê·¸ì•„ì›ƒ
            document.getElementById('social-logout-btn').addEventListener('click', async () => {
                const success = await socialAuth.socialLogout();
                updateStatus('user-status', success ? 'âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ' : 'âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨');
                if (success) {
                    document.getElementById('user-info-display').style.display = 'none';
                }
            });

            // API í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤
            document.getElementById('test-providers-api').addEventListener('click', async () => {
                try {
                    const response = await fetch('/api/users/auth/social/providers/');
                    const data = await response.json();
                    updateStatus('api-test-result', `âœ… ì œê³µì—…ì²´ ëª©ë¡:\n${JSON.stringify(data, null, 2)}`);
                } catch (error) {
                    updateStatus('api-test-result', `âŒ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
                }
            });

            document.getElementById('test-refresh-token').addEventListener('click', async () => {
                try {
                    const accessToken = localStorage.getItem('access_token');
                    if (!accessToken) {
                        throw new Error('ì•¡ì„¸ìŠ¤ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    const response = await fetch('/api/users/auth/social/token/refresh/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${accessToken}`,
                            'X-CSRFToken': socialAuth.csrfToken
                        },
                        body: JSON.stringify({ provider: 'google' })
                    });
                    const data = await response.json();
                    updateStatus('api-test-result', `í† í° ê°±ì‹  ê²°ê³¼:\n${JSON.stringify(data, null, 2)}`);
                } catch (error) {
                    updateStatus('api-test-result', `âŒ í† í° ê°±ì‹  ì‹¤íŒ¨: ${error.message}`);
                }
            });

            document.getElementById('test-auth-stats').addEventListener('click', async () => {
                try {
                    const accessToken = localStorage.getItem('access_token');
                    if (!accessToken) {
                        throw new Error('ì•¡ì„¸ìŠ¤ í† í°ì´ ì—†ìŠµë‹ˆë‹¤. (ê´€ë¦¬ì ê¶Œí•œ í•„ìš”)');
                    }

                    const response = await fetch('/api/users/auth/social/stats/', {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    });
                    const data = await response.json();
                    updateStatus('api-test-result', `ì¸ì¦ í†µê³„:\n${JSON.stringify(data, null, 2)}`);
                } catch (error) {
                    updateStatus('api-test-result', `âŒ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`);
                }
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            const accessToken = localStorage.getItem('access_token');
            if (accessToken) {
                updateStatus('login-status', 'ğŸ” ê¸°ì¡´ ë¡œê·¸ì¸ í† í°ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('load-user-info-btn').click();
                loadSocialAccountManager();
            }
        });

        // ê¸€ë¡œë²Œ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        window.addEventListener('error', (event) => {
            updateStatus('api-test-result', `âŒ JavaScript ì˜¤ë¥˜: ${event.error.message}`);
        });
    </script>
</body>

</html>