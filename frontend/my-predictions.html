<!DOCTYPE html>
<html lang="ko" class="h-full">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ë‚´ ì˜ˆì¸¡ - StockChart</title>
	<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“ˆ</text></svg>">

	<!-- Core Styles -->
	<link rel="stylesheet" href="css/figma-design.css">
	<link rel="stylesheet" href="css/mobile-trading.css">

	<!-- Fonts & Icons -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

	<!-- Charts -->
	<script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body class="home-body">
	<div class="home-desktop desktop-only">
		<header class="dashboard-top-bar">
			<div class="top-brand">
				<div class="brand-icon">
					<i class="fas fa-user-chart"></i>
				</div>
				<div>
					<p class="brand-eyebrow">ê°œì¸ íˆ¬ì ì„±ê³¼</p>
					<h1 class="brand-title">ë‚´ ì˜ˆì¸¡ ë³´ë“œ</h1>
				</div>
			</div>
			<nav class="top-nav-links">
				<a href="/" class="top-nav-link">
					<i class="fas fa-home"></i>
					<span>í™ˆ</span>
				</a>
				<a href="charts.html" class="top-nav-link">
					<i class="fas fa-chart-area"></i>
					<span>ì°¨íŠ¸</span>
				</a>
				<a href="prediction.html" class="top-nav-link">
					<i class="fas fa-magic"></i>
					<span>ì˜ˆì¸¡í•˜ê¸°</span>
				</a>
				<a href="my-predictions.html" class="top-nav-link active">
					<i class="fas fa-user-chart"></i>
					<span>ë‚´ ì˜ˆì¸¡</span>
				</a>
				<a href="ranking.html" class="top-nav-link">
					<i class="fas fa-trophy"></i>
					<span>ë­í‚¹</span>
				</a>
				<a href="events.html" class="top-nav-link">
					<i class="fas fa-calendar-star"></i>
					<span>ì´ë²¤íŠ¸</span>
				</a>
			</nav>
			<div class="top-actions">
				<button id="refreshPredictionsBtn" class="ghost-btn">
					<i class="fas fa-rotate"></i>
					ìƒˆë¡œê³ ì¹¨
				</button>
				<button id="newPredictionBtn" class="primary-btn">
					<i class="fas fa-plus"></i>
					ìƒˆ ì˜ˆì¸¡ ì‘ì„±
				</button>
			</div>
		</header>

		<section class="home-dashboard predictions-dashboard">
			<div id="statsOverview" class="home-metrics"></div>

			<div class="home-main-grid predictions-grid">
				<div class="predictions-table-card">
					<div class="card-heading">
						<div>
							<h2>ì˜ˆì¸¡ ë‚´ì—­</h2>
							<p>ì œì¶œí•œ ì˜ˆì¸¡ë“¤ì˜ ì§„í–‰ ìƒí™©ì„ ì¶”ì í•˜ì„¸ìš”.</p>
						</div>
						<div class="heading-actions">
							<button id="testDataBtn" class="ghost-btn">
								<i class="fas fa-flask"></i>
								í…ŒìŠ¤íŠ¸ ë°ì´í„°
							</button>
						</div>
					</div>

					<div class="predictions-filters">
						<div class="filter-group">
							<label for="statusFilter">ìƒíƒœ</label>
							<select id="statusFilter" class="filter-select">
								<option value="all">ì „ì²´</option>
								<option value="pending">ì§„í–‰ì¤‘</option>
								<option value="completed">ì™„ë£Œ</option>
								<option value="cancelled">ì·¨ì†Œë¨</option>
							</select>
						</div>
						<div class="filter-group">
							<label for="periodFilter">ê¸°ê°„</label>
							<select id="periodFilter" class="filter-select">
								<option value="all">ì „ì²´</option>
								<option value="week">ì´ë²ˆ ì£¼</option>
								<option value="month">ì´ë²ˆ ë‹¬</option>
								<option value="quarter">ìµœê·¼ 3ê°œì›”</option>
							</select>
						</div>
						<div class="filter-group">
							<label for="symbolFilter">ì¢…ëª©</label>
							<select id="symbolFilter" class="filter-select">
								<option value="all">ì „ì²´</option>
								<option value="crypto">ì•”í˜¸í™”í</option>
								<option value="us_stock">ë¯¸êµ­ ì£¼ì‹</option>
								<option value="kr_stock">êµ­ë‚´ ì£¼ì‹</option>
							</select>
						</div>
					</div>

					<div class="predictions-table-wrapper">
						<table class="predictions-table">
							<thead>
								<tr>
									<th>ì¢…ëª©</th>
									<th>ì˜ˆì¸¡ì¼</th>
									<th>ê¸°ì¤€ê°€</th>
									<th>ì˜ˆì¸¡ê°€</th>
									<th>ë³€ë™ë¥ </th>
									<th>ëª©í‘œì¼</th>
									<th>ìƒíƒœ</th>
									<th>ë™ì‘</th>
								</tr>
							</thead>
							<tbody id="predictionsTableBody"></tbody>
						</table>
						<div id="predictionsLoading" class="predictions-loading hidden">
							<i class="fas fa-spinner fa-spin"></i>
							ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
						</div>
						<div id="emptyState" class="predictions-empty hidden">
							<div class="empty-icon">
								<i class="fas fa-user-clock"></i>
							</div>
							<h3>ë“±ë¡ëœ ì˜ˆì¸¡ì´ ì—†ìŠµë‹ˆë‹¤</h3>
							<p>ì²« ë²ˆì§¸ ì˜ˆì¸¡ì„ ë“±ë¡í•˜ê³  ì‹¤ì‹œê°„ ì„±ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>
							<button class="primary-btn" id="emptyStateAction">
								<i class="fas fa-pen"></i>
								ì˜ˆì¸¡ ë§Œë“¤ê¸°
							</button>
						</div>
					</div>
				</div>

				<aside class="home-order-card predictions-form-card">
					<div class="order-header">
						<h3>ë¹ ë¥¸ ì˜ˆì¸¡ ë“±ë¡</h3>
						<span>ë°ì´í„° ê¸°ë°˜ ì¶”ì²œì„ í™œìš©í•´ ë¹ ë¥´ê²Œ ì œì¶œí•˜ì„¸ìš”.</span>
					</div>
					<form class="order-form" id="quickPredictionForm">
						<label class="order-label" for="quickAsset">ìì‚° ì„ íƒ</label>
						<select id="quickAsset" class="order-input">
							<option value="BTC" selected>BTC / USD</option>
							<option value="ETH">ETH / USD</option>
							<option value="KOSPI">KOSPI 200</option>
							<option value="AAPL">AAPL</option>
						</select>

						<label class="order-label">ë°©í–¥</label>
						<div class="direction-toggle">
							<button type="button" class="direction-btn active" data-direction="up">
								<i class="fas fa-arrow-trend-up"></i>
								ìƒìŠ¹
							</button>
							<button type="button" class="direction-btn" data-direction="down">
								<i class="fas fa-arrow-trend-down"></i>
								í•˜ë½
							</button>
						</div>

						<label class="order-label" for="quickTarget">ëª©í‘œ ê°€ê²©</label>
						<div class="order-input-group">
							<span>â‚©</span>
							<input id="quickTarget" class="order-input" type="number" placeholder="43,500,000">
						</div>

						<label class="order-label" for="quickPeriod">ì˜ˆì¸¡ ê¸°ê°„</label>
						<select id="quickPeriod" class="order-input">
							<option value="1D">1ì¼</option>
							<option value="3D">3ì¼</option>
							<option value="1W" selected>1ì£¼ì¼</option>
							<option value="1M">1ê°œì›”</option>
						</select>

						<button type="submit" class="order-submit">
							<i class="fas fa-meteor"></i>
							ì˜ˆì¸¡ ì œì¶œ
						</button>
					</form>
					<div class="order-footnote">
						<p><i class="fas fa-shield-alt"></i> ì œì¶œëœ ì˜ˆì¸¡ì€ ëŒ€ì‹œë³´ë“œì™€ ë­í‚¹ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
						<p><i class="fas fa-clock"></i> í‰ê·  ê²€ì¦ ì‹œê°„ 2ë¶„ ë¯¸ë§Œ Â· ì‹ ë¢°ë„ ì§€ìˆ˜ 94%</p>
					</div>
				</aside>
			</div>

			<div class="home-bottom-grid">
				<div class="home-prediction-board">
					<div class="board-header">
						<div>
							<h3>ìµœê·¼ ì˜ˆì¸¡ í™œë™</h3>
							<span>ìë™ ë¶„ì„ìœ¼ë¡œ ì„ ë³„ëœ ì„±ê³¼ í•˜ì´ë¼ì´íŠ¸</span>
						</div>
						<button class="board-action" id="exportPredictionsBtn">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
					</div>
					<table class="board-table" id="summaryBoard">
						<thead>
							<tr>
								<th>ì‚¬ìš©ì</th>
								<th>ì˜ˆì¸¡</th>
								<th>ê¸°ê°„</th>
								<th>ê²°ê³¼</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<div class="board-user">
										<span class="avatar">MJ</span>
										<div>
											<span class="board-name">ë§ˆì¼“ì €ë‹ˆ</span>
											<span class="board-meta">í”„ë¦¬ë¯¸ì—„</span>
										</div>
									</div>
								</td>
								<td>BTC / USD</td>
								<td>3ì¼</td>
								<td class="positive">+5.2%</td>
							</tr>
							<tr>
								<td>
									<div class="board-user">
										<span class="avatar">SK</span>
										<div>
											<span class="board-name">ìŠ¤ìœ™í‚¹</span>
											<span class="board-meta">ì±Œë¦°ì§€</span>
										</div>
									</div>
								</td>
								<td>KOSPI 200</td>
								<td>1ì£¼</td>
								<td class="negative">-1.8%</td>
							</tr>
							<tr>
								<td>
									<div class="board-user">
										<span class="avatar">IN</span>
										<div>
											<span class="board-name">Insight Rocket</span>
											<span class="board-meta">ìë™ ì¶”ì²œ</span>
										</div>
									</div>
								</td>
								<td>ETH / USD</td>
								<td>5ì¼</td>
								<td class="positive">+3.9%</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="home-news-card">
					<div class="board-header">
						<div>
							<h3>ì‹œì¥ ì•Œë¦¼ & ë‰´ìŠ¤</h3>
							<span>í¬ì§€ì…˜ ìœ ì§€ì™€ ë¦¬ë°¸ëŸ°ì‹±ì— ì°¸ê³ í•˜ì„¸ìš”.</span>
						</div>
						<button class="board-action" id="refreshNewsBtn">ì—…ë°ì´íŠ¸</button>
					</div>
					<ul class="news-list" id="newsList">
						<li>
							<div>
								<span class="news-title">ì‹œìŠ¤í…œ ì¸ì‚¬ì´íŠ¸: BTC ì¥ì¤‘ ë³€ë™ì„± 12% ê°ì†Œ, í¬ì§€ì…˜ ìœ ì§€ ê¶Œì¥</span>
								<span class="news-meta">8ë¶„ ì „ Â· ì‹œìŠ¤í…œ ë¶„ì„</span>
							</div>
							<span class="news-tag positive">ì•ˆì •</span>
						</li>
						<li>
							<div>
								<span class="news-title">êµ­ë‚´ ë°˜ë„ì²´ ì„¹í„° ì™¸êµ­ì¸ ìˆœë§¤ìˆ˜ í™•ëŒ€</span>
								<span class="news-meta">32ë¶„ ì „ Â· êµ­ë‚´ ì¦ì‹œ</span>
							</div>
							<span class="news-tag neutral">ì¤‘ë¦½</span>
						</li>
						<li>
							<div>
								<span class="news-title">ì˜ˆì¸¡ ëª¨ë¸ ì—…ë°ì´íŠ¸, í‰ê·  ì •í™•ë„ 1.8% ìƒìŠ¹</span>
								<span class="news-meta">1ì‹œê°„ ì „ Â· ì‹œìŠ¤í…œê³µì§€</span>
							</div>
							<span class="news-tag positive">í˜¸ì¬</span>
						</li>
					</ul>
				</div>
			</div>
		</section>
	</div>

	<nav class="mobile-bottom-nav mobile-only">
		<a href="/" class="mobile-nav-item">
			<i class="fas fa-home"></i>
			<span>í™ˆ</span>
		</a>
		<a href="charts.html" class="mobile-nav-item">
			<i class="fas fa-chart-area"></i>
			<span>ì°¨íŠ¸</span>
		</a>
		<a href="prediction.html" class="mobile-nav-item">
			<i class="fas fa-magic"></i>
			<span>ì˜ˆì¸¡</span>
		</a>
		<a href="my-predictions.html" class="mobile-nav-item active">
			<i class="fas fa-user-chart"></i>
			<span>ë‚´ ì˜ˆì¸¡</span>
		</a>
	</nav>

	<div id="predictionToast" class="home-toast"></div>

	<script>
		const state = {
			predictions: [],
			filtered: [],
			currentFilters: {
				status: 'all',
				period: 'all',
				symbol: 'all'
			}
		};

		document.addEventListener('DOMContentLoaded', () => {
			const refreshBtn = document.getElementById('refreshPredictionsBtn');
			const testDataBtn = document.getElementById('testDataBtn');
			const emptyStateAction = document.getElementById('emptyStateAction');
			const newPredictionBtn = document.getElementById('newPredictionBtn');
			const quickForm = document.getElementById('quickPredictionForm');

			attachFilterListeners();

			refreshBtn?.addEventListener('click', loadUserPredictions);
			testDataBtn?.addEventListener('click', loadTestData);
			emptyStateAction?.addEventListener('click', handleCreatePrediction);
			newPredictionBtn?.addEventListener('click', handleCreatePrediction);

			quickForm?.addEventListener('submit', event => {
				event.preventDefault();
				handleCreatePrediction();
			});

			document.querySelectorAll('.direction-btn').forEach(btn => {
				btn.addEventListener('click', () => {
					document.querySelectorAll('.direction-btn').forEach(b => b.classList.remove('active'));
					btn.classList.add('active');
				});
			});

			loadUserPredictions();
		});

		function attachFilterListeners() {
			const statusFilter = document.getElementById('statusFilter');
			const periodFilter = document.getElementById('periodFilter');
			const symbolFilter = document.getElementById('symbolFilter');

			statusFilter?.addEventListener('change', event => {
				state.currentFilters.status = event.target.value;
				applyFilters();
			});

			periodFilter?.addEventListener('change', event => {
				state.currentFilters.period = event.target.value;
				applyFilters();
			});

			symbolFilter?.addEventListener('change', event => {
				state.currentFilters.symbol = event.target.value;
				applyFilters();
			});
		}

		async function loadUserPredictions() {
			showLoadingState();

			try {
				const response = await fetch('/api/charts/predictions/all/');
				if (!response.ok) {
					throw new Error(`API error: ${response.status}`);
				}

				const payload = await response.json();
				const allPredictions = payload.predictions || [];
				state.predictions = allPredictions.filter(item => item.user?.username?.toLowerCase() === 'anonymous');
			} catch (error) {
				console.warn('Falling back to local predictions:', error.message);
				const stored = localStorage.getItem('userPredictions');
				state.predictions = stored ? JSON.parse(stored) : [];
			}

			hideLoadingState();
			applyFilters();
			renderStats();
		}

		function loadTestData() {
			state.predictions = [
				{
					id: 'demo-1',
					symbol: 'BTC',
					stock_name: 'Bitcoin Spot',
					market_type: 'crypto',
					current_price: 42850,
					predicted_price: 45200,
					prediction_date: '2025-10-07T09:15:00Z',
					target_date: '2025-10-14T09:15:00Z',
					duration_days: 7,
					status: 'pending',
					created_at: '2025-10-07T09:15:00Z',
					user: { username: 'anonymous' }
				},
				{
					id: 'demo-2',
					symbol: 'KOSPI200',
					stock_name: 'KOSPI 200',
					market_type: 'kr_stock',
					current_price: 312.4,
					predicted_price: 318.7,
					prediction_date: '2025-09-28T02:00:00Z',
					target_date: '2025-10-05T02:00:00Z',
					duration_days: 7,
					status: 'completed',
					profit_rate: 2.1,
					created_at: '2025-09-28T02:00:00Z',
					user: { username: 'anonymous' }
				},
				{
					id: 'demo-3',
					symbol: 'AAPL',
					stock_name: 'Apple Inc.',
					market_type: 'us_stock',
					current_price: 189.2,
					predicted_price: 182.6,
					prediction_date: '2025-09-20T13:40:00Z',
					target_date: '2025-09-27T13:40:00Z',
					duration_days: 7,
					status: 'completed',
					profit_rate: -3.4,
					created_at: '2025-09-20T13:40:00Z',
					user: { username: 'anonymous' }
				}
			];

			hideLoadingState();
			applyFilters();
			renderStats();
			showToast('í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
		}

		function applyFilters() {
			const { status, period, symbol } = state.currentFilters;
			const now = new Date();

			state.filtered = state.predictions.filter(prediction => {
				if (status !== 'all' && prediction.status !== status) {
					return false;
				}

				if (symbol !== 'all' && prediction.market_type !== symbol) {
					return false;
				}

				if (period !== 'all') {
					const target = new Date(prediction.target_date || prediction.prediction_date);
					const diff = (now - target) / (1000 * 60 * 60 * 24);

					if (period === 'week' && diff > 7) return false;
					if (period === 'month' && diff > 30) return false;
					if (period === 'quarter' && diff > 90) return false;
				}

				return true;
			});

			renderPredictions();
		}

		function renderStats() {
			const container = document.getElementById('statsOverview');

			if (!container) return;

			if (state.predictions.length === 0) {
				container.innerHTML = `
					<div class="metric-card primary">
						<div class="metric-label">ì´ ì˜ˆì¸¡ ìˆ˜</div>
						<div class="metric-value">0</div>
						<div class="metric-sub">ì²« ì˜ˆì¸¡ì„ ë“±ë¡í•´ë³´ì„¸ìš”.</div>
					</div>
					<div class="metric-card">
						<div class="metric-label">ì •í™•ë„</div>
						<div class="metric-value">0%</div>
						<div class="metric-sub">ì™„ë£Œëœ ì˜ˆì¸¡ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
					</div>
					<div class="metric-card">
						<div class="metric-label">ëˆ„ì  ìˆ˜ìµë¥ </div>
						<div class="metric-value">0%</div>
						<div class="metric-sub">ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ë©´ í‘œì‹œë©ë‹ˆë‹¤.</div>
					</div>
					<div class="metric-card">
						<div class="metric-label">ì—°ì† ì„±ê³µ</div>
						<div class="metric-value">0</div>
						<div class="metric-sub">ì„±ê³µ ê¸°ë¡ì„ ì‹œì‘í•´ë³´ì„¸ìš”.</div>
					</div>
				`;
				return;
			}

			const completed = state.predictions.filter(p => p.status === 'completed');
			const successful = completed.filter(p => (p.profit_rate || 0) > 0);
			const totalReturn = completed.reduce((sum, p) => sum + (parseFloat(p.profit_rate) || 0), 0);

			container.innerHTML = `
				<div class="metric-card primary">
					<div class="metric-label">ì´ ì˜ˆì¸¡ ìˆ˜</div>
					<div class="metric-value">${state.predictions.length}</div>
					<div class="metric-change ${state.filtered.length >= state.predictions.length ? 'positive' : ''}">
						ì‹¤ì‹œê°„ ë™ê¸°í™” ì™„ë£Œ
					</div>
				</div>
				<div class="metric-card">
					<div class="metric-label">ì •í™•ë„</div>
					<div class="metric-value">${completed.length ? ((successful.length / completed.length) * 100).toFixed(1) : '0.0'}%</div>
					<div class="metric-sub">ì™„ë£Œëœ ì˜ˆì¸¡ ê¸°ì¤€</div>
				</div>
				<div class="metric-card">
					<div class="metric-label">ëˆ„ì  ìˆ˜ìµë¥ </div>
					<div class="metric-value ${totalReturn >= 0 ? 'positive-text' : 'negative-text'}">${totalReturn >= 0 ? '+' : ''}${totalReturn.toFixed(1)}%</div>
					<div class="metric-sub">ì™„ë£Œëœ ì˜ˆì¸¡ í•©ì‚°</div>
				</div>
				<div class="metric-card">
					<div class="metric-label">ì—°ì† ì„±ê³µ</div>
					<div class="metric-value">${calculateSuccessStreak()}</div>
					<div class="metric-sub">ìµœê·¼ ì œì¶œ ê¸°ì¤€</div>
				</div>
			`;
		}

		function calculateSuccessStreak() {
			const completed = [...state.predictions]
				.filter(p => p.status === 'completed')
				.sort((a, b) => new Date(b.target_date || b.created_at) - new Date(a.target_date || a.created_at));

			let streak = 0;
			for (const prediction of completed) {
				if ((prediction.profit_rate || 0) > 0) {
					streak += 1;
				} else {
					break;
				}
			}
			return streak;
		}

		function renderPredictions() {
			const tableBody = document.getElementById('predictionsTableBody');
			const emptyState = document.getElementById('emptyState');

			if (!tableBody) return;

			if (state.filtered.length === 0) {
				tableBody.innerHTML = '';
				emptyState?.classList.remove('hidden');
				return;
			}

			emptyState?.classList.add('hidden');
			const rows = state.filtered.map(renderPredictionRow).join('');
			tableBody.innerHTML = rows;
		}

		function renderPredictionRow(prediction) {
			const predictionDate = new Date(prediction.prediction_date);
			const targetDate = new Date(prediction.target_date || prediction.prediction_date);
			const now = new Date();
			const priceChange = calculatePriceChange(prediction);

			const directionClass = priceChange >= 0 ? 'positive-text' : 'negative-text';
			const statusConfig = resolveStatusConfig(prediction, now >= targetDate);

			return `
				<tr>
					<td>
						<div class="table-symbol">
							<span class="symbol-tag">${prediction.symbol}</span>
							<span class="symbol-meta">${prediction.stock_name || '&middot;'}</span>
						</div>
					</td>
					<td>
						<div class="table-col">
							<strong>${formatDate(predictionDate)}</strong>
							<span>${prediction.user?.username || 'anonymous'}</span>
						</div>
					</td>
					<td class="numeric">${formatCurrency(prediction.current_price)}</td>
					<td class="numeric">${formatCurrency(prediction.predicted_price)}</td>
					<td class="numeric ${directionClass}">
						${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}%
						${prediction.accuracy_percentage ? `<span class="subtext">ì •í™•ë„ ${parseFloat(prediction.accuracy_percentage).toFixed(1)}%</span>` : ''}
					</td>
					<td>
						<div class="table-col">
							<strong>${formatDate(targetDate)}</strong>
							${prediction.status === 'pending' && now < targetDate ? `<span class="subtext">D-${Math.max(0, Math.ceil((targetDate - now) / 86400000))}</span>` : ''}
						</div>
					</td>
					<td>
						<span class="status-chip ${statusConfig.class}">
							<i class="fas ${statusConfig.icon}"></i>
							${statusConfig.label}
						</span>
					</td>
					<td>
						<div class="table-actions">
							<button class="ghost-btn small" data-action="view" data-id="${prediction.id}">
								ìì„¸íˆ
							</button>
							${prediction.status === 'pending' ? `<button class="ghost-btn small" data-action="cancel" data-id="${prediction.id}">ì·¨ì†Œ</button>` : ''}
						</div>
					</td>
				</tr>
			`;
		}

		function resolveStatusConfig(prediction, isCompleted) {
			if (prediction.status === 'cancelled') {
				return { label: 'ì·¨ì†Œë¨', class: 'neutral', icon: 'fa-ban' };
			}

			if (prediction.status === 'completed' || isCompleted) {
				const profit = prediction.profit_rate || calculatePriceChange(prediction);
				return profit >= 0
					? { label: 'ì„±ê³µ', class: 'success', icon: 'fa-arrow-trend-up' }
					: { label: 'ì™„ë£Œ', class: 'warning', icon: 'fa-arrow-trend-down' };
			}

			return { label: 'ì§„í–‰ì¤‘', class: 'info', icon: 'fa-clock' };
		}

		function calculatePriceChange(prediction) {
			const base = parseFloat(prediction.current_price) || 0;
			const target = parseFloat(prediction.predicted_price) || base;

			if (!base) return 0;
			return ((target - base) / base) * 100;
		}

		function formatCurrency(value) {
			const number = parseFloat(value) || 0;
			if (Math.abs(number) >= 100000) {
				return `$${number.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
			}
			return `$${number.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
		}

		function formatDate(date) {
			if (!(date instanceof Date) || isNaN(date)) {
				return '-';
			}
			return date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
		}

		function showLoadingState() {
			const loading = document.getElementById('predictionsLoading');
			const emptyState = document.getElementById('emptyState');
			const tableBody = document.getElementById('predictionsTableBody');

			loading?.classList.remove('hidden');
			emptyState?.classList.add('hidden');
			if (tableBody) tableBody.innerHTML = '';
		}

		function hideLoadingState() {
			const loading = document.getElementById('predictionsLoading');
			loading?.classList.add('hidden');
		}

		function handleCreatePrediction() {
			showToast('ì˜ˆì¸¡ ì‘ì„± í˜ì´ì§€ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.');
		}

		function showToast(message, type = 'success') {
			const toast = document.getElementById('predictionToast');
			if (!toast) return;

			toast.textContent = message;
			toast.className = `home-toast visible ${type}`;

			clearTimeout(showToast.timer);
			showToast.timer = setTimeout(() => {
				toast.classList.remove('visible');
			}, 3200);
		}

		document.addEventListener('click', event => {
			const target = event.target.closest('[data-action]');
			if (!target) return;

			const id = target.getAttribute('data-id');
			const action = target.getAttribute('data-action');

			if (action === 'view') {
				showToast('ìƒì„¸ ë¶„ì„ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
			}

			if (action === 'cancel') {
				const prediction = state.predictions.find(item => String(item.id) === String(id));
				if (!prediction) return;

				prediction.status = 'cancelled';
				localStorage.setItem('userPredictions', JSON.stringify(state.predictions));
				applyFilters();
				renderStats();
				showToast('ì˜ˆì¸¡ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
			}
		});
	</script>
</body>
</html>

